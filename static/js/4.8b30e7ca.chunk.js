(this["webpackJsonpsokobot-3d"]=this["webpackJsonpsokobot-3d"]||[]).push([[4],{151:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(20),c=n(13),i=n(34),l=n(50),u=n(53),s=n(115),m=n(112),f=n(15),v=n(126);var b=function(e){Object(a.useEffect)(e,[])},d=n(10);var g=function(e){var t=Object(a.useRef)(),n=t.current,r=void 0===n?e:Object(d.c)(n,e);return Object(a.useEffect)((function(){t.current=r})),r};var h=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){t.current=e})),t.current},p=n(117),E=n.n(p),O=n(4),j=n(118),y=n(116);var k=function(e){var t=e.position,n=h(e);return Object(y.c)({from:null!==n&&void 0!==n?n:e,to:function(){var a=Object(j.a)(E.a.mark((function a(r){return E.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!(n&&t[2]<n.position[2])){a.next=6;break}return a.next=3,r(Object(O.a)(Object(O.a)({},e),{},{position:[t[0],t[1],n.position[2]]}));case 3:return a.next=5,r(Object(O.a)(Object(O.a)({},e),{},{config:{duration:100}}));case 5:return a.abrupt("return");case 6:return a.next=8,r(e);case 8:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()})};Object(s.d)({OrbitControls:v.a});var w=Object(o.c)((function(e){return{initialPosition:function(){try{var t=l.c.getMapDimensions(e.game),n=Math.max(3,.7*Math.max.apply(Math,Object(f.a)(t)));return[n,n,n]}catch(a){}}()}}))((function(e){var t=e.initialPosition,n=Object(s.g)(),o=n.camera,c=n.gl,i=Object(a.useRef)();return b((function(){var e;t&&((e=o.position).set.apply(e,Object(f.a)(t)),i.current&&i.current.update())})),r.a.createElement("orbitControls",{args:[o,c.domElement],maxPolarAngle:Math.PI/2,enablePan:!1,ref:i})})),x=n(8),L=n(142);var C=function(e){var t=e.position,n=k({position:t});return r.a.createElement(L.a.mesh,Object.assign({},n,{castShadow:!0,receiveShadow:!0}),r.a.createElement("boxBufferGeometry",{attach:"geometry",args:[1,1,1]}),r.a.createElement("meshLambertMaterial",{attach:"material",color:11176004}))};var S=function(e){var t=e.x,n=e.y,a=e.height;return r.a.createElement("mesh",{position:[t,n,(1+a)/2],castShadow:!0,receiveShadow:!0},r.a.createElement("boxBufferGeometry",{attach:"geometry",args:[1,1,a]}),r.a.createElement("meshPhongMaterial",{attach:"material",color:5592405}))},M=n(144);function I(e){var t=e.position,n=e.direction,a=Object(s.f)(M.a,"/sokobot-3d/3d-models/robot.glb").scene.children[0].geometry,o=new m.MeshStandardMaterial({roughness:.5,metalness:.6}),c=g(n),i=k({position:t,rotation:[0,0,c]});return r.a.createElement(L.a.mesh,Object.assign({},i,{castShadow:!0,receiveShadow:!0,geometry:a,material:o}))}var R=Object(o.c)((function(e){return{position:l.c.getRobotPosition(e.game),direction:Object(d.b)(l.c.getRobotDirection(e.game))}}))((function(e){return r.a.createElement(a.Suspense,{fallback:null},r.a.createElement(I,e))}));var P=function(e){var t=e.x,n=e.y,a=e.height;return r.a.createElement("mesh",{position:[t,n,a+.51],receiveShadow:!0},r.a.createElement("planeBufferGeometry",{attach:"geometry",args:[1,1]}),r.a.createElement("meshLambertMaterial",{attach:"material",color:65280}))};var T=Object(o.c)((function(e){return{mapDimensions:l.c.getMapDimensions(e.game),tilesInfo:l.c.getTilesInfo(e.game),movableObjectsInfo:l.c.getMovableObjectsInfo(e.game),robotKey:l.c.getRobotKey(e.game)}}))((function(e){var t=e.mapDimensions,n=e.tilesInfo,o=e.movableObjectsInfo,c=e.robotKey,i=Object(x.a)(t,2),l=i[0],u=i[1];return r.a.createElement("group",{position:[(1-l)/2,(1-u)/2,-.5]},r.a.createElement(R,{key:c}),n.map((function(e){var t=e.x,n=e.y,o=e.height,c=e.hasTarget;return r.a.createElement(a.Fragment,{key:"".concat(t,"-").concat(n)},o>0&&r.a.createElement(S,{x:t,y:n,height:o}),c&&r.a.createElement(P,{x:t,y:n,height:o}))})),o.map((function(e){var t=e.key,n=e.position;return r.a.createElement(C,{key:t,position:n})})))}));var B=function(){return r.a.createElement(o.b.Consumer,null,(function(e){var t=e.store;return r.a.createElement(s.a,{shadowMap:!0,style:{backgroundColor:"black",height:"100%",position:"absolute",top:0,left:0}},r.a.createElement(o.a,{store:t},r.a.createElement(w,null),r.a.createElement("group",{rotation:[-Math.PI/2,0,0]},!1,r.a.createElement("ambientLight",{intensity:.4}),r.a.createElement("spotLight",{color:new m.Color("#fffda7"),castShadow:!0,intensity:.7,penumbra:1,decay:1,angle:Math.PI/8,position:[10,10,10],"shadow-mapSize-width":2048,"shadow-mapSize-height":2048}),r.a.createElement(T,null))))}))},D=n(29),z=n(49),F=n(110),G=n(146),U=n(147),A=n(148),K=n(149),N=n(1);function J(){var e=Object(D.a)(["\n  position: fixed;\n  bottom: .5rem;\n  right: .5rem;\n  z-index: 1000;\n"]);return J=function(){return e},e}var W=N.default.div(J());function q(e){return r.a.createElement(F.a,Object.assign({},e,{plain:!1,margin:"xxsmall"}))}var H=Object(o.c)((function(e){return{displayOnScreenControls:l.g.displayOnScreenControls(e.settings)}}),(function(e){return{moveForward:function(){return e(l.b.moveForward())},moveBackward:function(){return e(l.b.moveBackward())},turnLeft:function(){return e(l.b.turnLeft())},turnRight:function(){return e(l.b.turnRight())}}}))((function(e){var t,n=e.displayOnScreenControls,a=e.moveForward,o=e.moveBackward,c=e.turnLeft,i=e.turnRight,l=(t={W:a,A:c,S:o,D:i},function(e){var n=e.key.toUpperCase();n in t&&t[n].call(null)});return b((function(){return window.addEventListener("keypress",l),function(){window.removeEventListener("keypress",l)}})),n?r.a.createElement(W,null,r.a.createElement(z.a,{align:"center"},r.a.createElement(q,{icon:r.a.createElement(G.a,null),title:"Move forward (W)",onClick:a})),r.a.createElement(z.a,{direction:"row"},r.a.createElement(q,{icon:r.a.createElement(U.a,null),title:"Turn left (A)",onClick:c}),r.a.createElement(q,{icon:r.a.createElement(A.a,null),title:"Move backward (S)",onClick:o}),r.a.createElement(q,{icon:r.a.createElement(K.a,null),title:"Turn right (D)",onClick:i}))):null})),Q=n(11);function V(){var e=Object(D.a)(["\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 1000;\n  background-color: rgba(0, 0, 0, 0.3);\n  border-radius: 1em;\n  h1 {\n    text-align: center;\n    line-height: 1.2em;\n  }\n"]);return V=function(){return e},e}var X=N.default.div(V());var Y=Object(o.c)((function(e){return{nextLevel:l.e.getNextLevel(e.levels)}}),(function(e){return{goToLevel:function(t){e(Object(Q.e)("/level/".concat(t)))},goToLevelSelection:function(){e(Object(Q.e)("/select-level"))}}}))((function(e){var t=e.nextLevel,n=e.goToLevel,a=e.goToLevelSelection,o=void 0===t?"Congratulations, you finished the game!":"Level Cleared";return r.a.createElement(X,null,r.a.createElement(z.a,{width:"medium",gap:"small",align:"stretch",pad:"small"},r.a.createElement("h1",{"data-testid":"message"},o),void 0!==t&&r.a.createElement(F.a,{label:"Go to next level",onClick:function(){return n(t)}}),r.a.createElement(F.a,{label:"Back to level selection",onClick:a})))})),Z=n(150);function $(){var e=Object(D.a)(["\n  position: fixed;\n  top: .5rem;\n  left: .5rem;\n  z-index: 1000;\n"]);return $=function(){return e},e}var _=N.default.div($());var ee=Object(o.c)((function(e){return{level:l.e.getSelectedLevel(e.levels)}}),(function(e){return{restart:function(t){return e(l.d.selectLevel(t))}}}))((function(e){var t=e.level,n=e.restart;return r.a.createElement(_,null,r.a.createElement(F.a,{label:"Restart",icon:r.a.createElement(Z.a,null),onClick:function(){return n(t)}}))}));var te=Object(o.c)((function(e,t){var n=t.match,a=parseInt(n.params.level);return{isLevelCleared:l.c.isLevelCleared(e.game),isUnlocked:l.e.isUnlocked(e.levels,a),levelName:Object(i.b)()[a]}}))((function(e){var t=e.isLevelCleared,n=e.isUnlocked,a=e.levelName;return void 0!==a&&n?r.a.createElement(u.a,{title:a},r.a.createElement(B,null),t?r.a.createElement(Y,null):r.a.createElement(r.a.Fragment,null,r.a.createElement(H,null),r.a.createElement(ee,null))):r.a.createElement(c.a,{to:"/select-level"})}));t.default=te}}]);
//# sourceMappingURL=4.8b30e7ca.chunk.js.map