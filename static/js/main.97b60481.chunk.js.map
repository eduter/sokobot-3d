{"version":3,"sources":["mechanics/directions.ts","mechanics/getRelevantTiles.ts","mechanics/isLevelCleared.ts","mechanics/isMoveValid.ts","mechanics/pushObjects.ts","state/ducks/levels/types.ts","state/ducks/levels/actions.ts","state/ducks/levels/selectors.ts","state/ducks/levels/reducer.ts","state/ducks/game/types.ts","state/ducks/levels/index.ts","state/ducks/game/actions.ts","state/ducks/game/reducer.ts","state/ducks/game/selectors.ts","state/ducks/game/index.ts","state/ducks/index.ts","state/localStorage.ts","state/store.ts","components/BackButton.tsx","components/Screen.tsx","components/screens/Settings.tsx","components/screens/Menu.tsx","components/screens/LevelSelection.tsx","utils/useEffectOnce.ts","components/webgl/CameraControls.tsx","components/webgl/CardboardBox.tsx","components/webgl/GroundElevation.tsx","components/webgl/Robot.tsx","components/webgl/TargetTile.tsx","components/webgl/Map.tsx","components/webgl/MyCanvas.tsx","components/screens/Level/Controls.tsx","components/screens/Level/LevelClearedDialog.tsx","components/screens/Level/RestartButton.tsx","components/screens/Level/Level.tsx","components/screens/Level/index.ts","theme.ts","components/App.tsx","serviceWorker.ts","index.tsx"],"names":["Direction","DIRECTIONS","NORTH","dx","dy","angle","EAST","Math","PI","SOUTH","WEST","rightOf","leftOf","move","point","direction","x","y","rotateRight","rotateLeft","oppositeDirection","getTile","tiles","undefined","getRelevantTiles","robotPosition","moveDirection","targetPosition","pushedObjectsPosition","isLevelCleared","levelMap","hasBox","tile","objects","some","o","type","targets","column","targetX","targetY","isValidTile","height","isMoveValid","currentTile","targetTile","pushedObectsTile","length","slice","pushObjects","from","robotX","robotY","fromX","fromY","toX","toY","robotTile","map","fromTile","ActionTypes","selectLevel","level","SELECT_LEVEL","payload","clearLevel","CLEAR_LEVEL","getSelectedLevel","state","selectedLevel","isUnlocked","unlockedLevels","INITIAL_STATE","parseLevel","path","startsWith","parseInt","substr","levelsReducer","reducer","action","LOCATION_CHANGE","location","pathname","loop","Cmd","levelData","levels","gameActions","startLevel","START_LEVEL","finishLevel","FINISH_LEVEL","moveForward","MOVE_FORWARD","moveBackward","MOVE_BACKWARD","turnRight","TURN_RIGHT","turnLeft","TURN_LEFT","MOVE","finished","canMove","relevantTiles","robot","position","getRobotPosition","Error","getRobotDirection","getMapDimensions","width","getTilesInfo","Set","tilesInfo","forEach","add","join","push","target","has","newState","getNeighbor","levelsActions","createRootReducer","history","combineReducers","game","router","connectRouter","setupStatePersistence","store","slices","previousState","Map","Object","entries","getState","subscribe","changedSlices","filter","sliceName","get","sliceState","serializedSlice","JSON","stringify","localStorage","setItem","err","console","warn","saveSliceState","PERSISTENT_SLICES","composeEnhancers","window","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","connector","connect","dispatch","goBack","Button","icon","Previous","label","onClick","H1","styled","h1","Screen","title","children","Box","gap","align","Settings","startGame","openSettings","Play","SettingsOption","levelsSelectors","_","key","Unlock","Lock","disabled","useEffectOnce","effect","useEffect","extend","OrbitControls","initialPosition","mapDimensions","gameSelectors","n","max","useThree","camera","gl","controls","useRef","set","current","update","args","domElement","maxPolarAngle","enablePan","ref","CardboardBox","castShadow","receiveShadow","attach","color","GroundElevation","actions","onKeyPress","event","addEventListener","removeEventListener","rotation","TargetTile","xSize","ySize","object","index","MyCanvas","Consumer","shadowMap","style","backgroundColor","top","left","process","intensity","Color","penumbra","decay","shadow-mapSize-width","shadow-mapSize-height","Wrapper","div","IconButton","props","plain","margin","LinkUp","RotateLeft","LinkDown","RotateRight","DialogWrapper","goToLevel","goToLevelSelection","nextLevel","pad","restart","Refresh","Level","match","params","name","to","theme","global","colors","dark","brand","control","text","background","font","family","persistedState","serializedSliceState","getItem","parse","loadPersistedState","createBrowserHistory","basename","enhancer","applyMiddleware","routerMiddleware","install","enhancedCreateStore","createStore","configureStore","App","Grommet","full","Main","exact","component","Menu","LevelSelection","render","isLocalhost","Boolean","hostname","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","log","onUpdate","onSuccess","catch","error","ReactDOM","document","getElementById","URL","href","origin","fetch","headers","response","contentType","status","indexOf","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.97b60481.chunk.js","sourcesContent":["export type Point2D = [number, number];\n\nenum Direction {\n  NORTH = 'NORTH',\n  EAST = 'EAST',\n  SOUTH = 'SOUTH',\n  WEST = 'WEST'\n}\n\nconst DIRECTIONS = {\n  NORTH: { dx: 0, dy: 1, angle: 0 },\n  EAST: { dx: 1, dy: 0, angle: -Math.PI / 2 },\n  SOUTH: { dx: 0, dy: -1, angle: Math.PI },\n  WEST: { dx: -1, dy: 0, angle: Math.PI / 2 }\n} as const;\n\nconst rightOf: Record<Direction, Direction> = {\n  [Direction.NORTH]: Direction.EAST,\n  [Direction.EAST]: Direction.SOUTH,\n  [Direction.SOUTH]: Direction.WEST,\n  [Direction.WEST]: Direction.NORTH\n};\n\nconst leftOf: Record<Direction, Direction> = {\n  [Direction.NORTH]: Direction.WEST,\n  [Direction.WEST]: Direction.SOUTH,\n  [Direction.SOUTH]: Direction.EAST,\n  [Direction.EAST]: Direction.NORTH\n};\n\nfunction move(point: Point2D, direction: Direction): Point2D {\n  const [x, y] = point;\n  const { dx, dy } = DIRECTIONS[direction];\n\n  return [x + dx, y + dy];\n}\n\nfunction rotateRight(direction: Direction): Direction {\n  return rightOf[direction];\n}\n\nfunction rotateLeft(direction: Direction): Direction {\n  return leftOf[direction];\n}\n\nfunction oppositeDirection(direction: Direction): Direction {\n  return rightOf[rightOf[direction]];\n}\n\nfunction directionToAngle(direction: Direction): number {\n  return DIRECTIONS[direction].angle;\n}\n\n\nexport {\n  Direction,\n  move,\n  rotateRight,\n  rotateLeft,\n  oppositeDirection,\n  directionToAngle\n};\n","import { Maybe } from '../utils/types';\nimport { Direction, move, Point2D } from './directions';\nimport { Tile } from './types';\n\n\nfunction getRelevantTiles(tiles: Tile[][], robotPosition: Point2D, moveDirection: Direction) {\n  const targetPosition = move(robotPosition, moveDirection);\n  const pushedObjectsPosition = move(targetPosition, moveDirection);\n\n  return [\n    getTile(tiles, robotPosition),\n    getTile(tiles, targetPosition),\n    getTile(tiles, pushedObjectsPosition)\n  ] as [Tile, Maybe<Tile>, Maybe<Tile>];\n}\n\nfunction getTile(tiles: Tile[][], [x, y]: Point2D): Maybe<Tile> {\n  return tiles[x] ? tiles[x][y] : undefined;\n}\n\n\nexport default getRelevantTiles;\n","import { LevelMap, Tile } from './types';\n\n\nfunction isLevelCleared(levelMap: LevelMap): boolean {\n  const hasBox = (tile: Tile) => tile.objects.some(o => o.type === 'box');\n\n  // checks for a target without a box\n  if (levelMap.targets.some(([x, y]) => !hasBox(levelMap.tiles[x][y]))) {\n    return false;\n  }\n\n  // checks for a box without a target\n  return !levelMap.tiles.some((column, x) => (\n    column.some((tile, y) => (\n      hasBox(tile) && !levelMap.targets.some(([targetX, targetY]) => targetX === x && targetY === y)\n    ))\n  ));\n}\n\n\nexport default isLevelCleared;\n","import { Maybe } from '../utils/types';\nimport { Tile } from './types';\n\n\nfunction isMoveValid(currentTile: Tile, targetTile: Maybe<Tile>, pushedObectsTile: Maybe<Tile>): boolean {\n  if (!isValidTile(targetTile)) {\n    // target is beyond the edge or is a hole\n    return false;\n  } else if (targetTile.height > currentTile.height + currentTile.objects.length) {\n    // trying to move toward a wall\n    return false;\n  }\n\n  const height = currentTile.height + currentTile.objects.length;\n  const pushedObjects = targetTile.objects.slice(height - targetTile.height);\n\n  if (pushedObjects.length > 0) {\n    if (!isValidTile(pushedObectsTile)) {\n      // trying to push objects into the void\n      return false;\n    } else if (pushedObectsTile.height + pushedObectsTile.objects.length > height) {\n      // trying to push objects into a wall/object\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction isValidTile(tile: Maybe<Tile>): tile is Tile {\n  return tile !== undefined && tile.height > 0;\n}\n\n\nexport default isMoveValid;\n","import { Direction, move, Point2D } from './directions';\nimport { Tile } from './types';\n\n\nfunction pushObjects(tiles: Tile[][], robotPosition: Point2D, direction: Direction): Tile[][] {\n  const from = move(robotPosition, direction);\n  const [robotX, robotY] = robotPosition;\n  const [fromX, fromY] = from;\n  const [toX, toY] = move(from, direction);\n  const robotTile = tiles[robotX][robotY];\n  const height = robotTile.height + robotTile.objects.length;\n\n  return tiles.map((column, x) => (\n    column.map((tile, y) => {\n      if (x === fromX && y === fromY) {\n        return {\n          ...tile,\n          objects: tile.objects.slice(0, height - tile.height)\n        };\n      } else if (x === toX && y === toY) {\n        const fromTile = tiles[fromX][fromY];\n        return {\n          ...tile,\n          objects: [...tile.objects, ...fromTile.objects.slice(height - fromTile.height)]\n        };\n      }\n      return tile;\n    })\n  ))\n}\n\n\nexport default pushObjects;\n","import { DeepReadonly } from 'utility-types';\n\n\nexport enum ActionTypes {\n  SELECT_LEVEL = 'levels/SELECT_LEVEL',\n  CLEAR_LEVEL = 'levels/CLEAR_LEVEL',\n}\n\nexport type State = DeepReadonly<{\n  readonly unlockedLevels: number;\n  readonly selectedLevel?: number;\n}>;\n","import { Action } from '../../../utils/types';\nimport { ActionTypes } from './types';\n\n\nexport type LevelsAction = (\n  Action<ActionTypes.SELECT_LEVEL, { level: number }>\n  | Action<ActionTypes.CLEAR_LEVEL>\n);\n\nfunction selectLevel(level: number): LevelsAction {\n  return {\n    type: ActionTypes.SELECT_LEVEL,\n    payload: {\n      level\n    }\n  };\n}\n\nfunction clearLevel(): LevelsAction {\n  return { type: ActionTypes.CLEAR_LEVEL };\n}\n\n\nexport {\n  selectLevel,\n  clearLevel\n};\n","import { State } from './types';\n\n\nfunction getSelectedLevel(state: State) {\n  return state.selectedLevel;\n}\n\nfunction isUnlocked(state: State, level: number) {\n  return level < state.unlockedLevels;\n}\n\n\nexport {\n  getSelectedLevel,\n  isUnlocked\n};\n","import { LOCATION_CHANGE, LocationChangeAction } from 'connected-react-router';\nimport { Cmd, loop } from 'redux-loop';\nimport levels from '../../../data/levels.json';\nimport { LevelMap } from '../../../mechanics/types';\nimport { assertNever, Maybe, Reducer } from '../../../utils/types';\nimport { gameActions } from '../game';\nimport { LevelsAction, selectLevel } from './actions';\nimport { isUnlocked } from './selectors';\nimport { ActionTypes, State } from './types';\n\n\nconst INITIAL_STATE: State = {\n  unlockedLevels: 1\n};\n\ntype HandledAction = LevelsAction | LocationChangeAction;\ntype TriggeredAction = LevelsAction | ReturnType<typeof gameActions.startLevel>;\n\nconst levelsReducer: Reducer<State, HandledAction, TriggeredAction> = (state = INITIAL_STATE, action) => {\n  switch (action.type) {\n    case LOCATION_CHANGE: {\n      const level = parseLevel(action.payload.location.pathname);\n\n      if (level !== undefined) {\n        return loop(\n          state,\n          Cmd.action(selectLevel(level))\n        );\n      }\n      return state;\n    }\n    case ActionTypes.SELECT_LEVEL: {\n      const { level } = action.payload;\n      const levelData = levels[level];\n\n      if (levelData && isUnlocked(state, level)) {\n        return loop(\n          { ...state, selectedLevel: level },\n          Cmd.action(gameActions.startLevel(levelData.map as unknown as LevelMap))\n        );\n      }\n      return state;\n    }\n    case ActionTypes.CLEAR_LEVEL:\n      return {\n        unlockedLevels: state.unlockedLevels + (state.selectedLevel === state.unlockedLevels - 1 ? 1 : 0)\n      };\n    default:\n      assertNever(action);\n      return state;\n  }\n};\n\nfunction parseLevel(path: string): Maybe<number> {\n  const prefix = '/level/';\n\n  if (!path.startsWith(prefix)) {\n    return undefined;\n  }\n  return parseInt(path.substr(prefix.length));\n}\n\n\nexport default levelsReducer;\n","import { LevelMap } from '../../../mechanics/types';\n\n\nexport enum ActionTypes {\n  START_LEVEL = 'game/START_LEVEL',\n  FINISH_LEVEL = 'game/FINISH_LEVEL',\n  MOVE = 'game/MOVE',\n  MOVE_FORWARD = 'game/MOVE_FORWARD',\n  MOVE_BACKWARD = 'game/MOVE_BACKWARD',\n  TURN_RIGHT = 'game/TURN_RIGHT',\n  TURN_LEFT = 'game/TURN_LEFT'\n}\n\nexport interface State {\n  finished: boolean;\n  map?: LevelMap;\n}\n","import reducer from './reducer';\nimport * as levelsActions from './actions';\nimport * as levelsSelectors from './selectors';\n\n\nexport {\n  levelsActions,\n  levelsSelectors\n};\n\n\nexport default reducer;\n","import { Direction } from '../../../mechanics/directions';\nimport { LevelMap } from '../../../mechanics/types';\nimport { Action } from '../../../utils/types';\nimport { ActionTypes } from './types';\n\n\nexport type GameAction = (\n  Action<ActionTypes.START_LEVEL, { map: LevelMap }>\n  | Action<ActionTypes.FINISH_LEVEL>\n  | Action<ActionTypes.MOVE_FORWARD>\n  | Action<ActionTypes.MOVE_BACKWARD>\n  | Action<ActionTypes.TURN_LEFT>\n  | Action<ActionTypes.TURN_RIGHT>\n  | Action<ActionTypes.MOVE, Direction>\n);\n\nfunction startLevel(map: LevelMap): GameAction {\n  return {\n    type: ActionTypes.START_LEVEL,\n    payload: {\n      map\n    }\n  };\n}\n\nfunction finishLevel(): GameAction {\n  return { type: ActionTypes.FINISH_LEVEL };\n}\n\nfunction moveForward(): GameAction {\n  return { type: ActionTypes.MOVE_FORWARD };\n}\n\nfunction moveBackward(): GameAction {\n  return { type: ActionTypes.MOVE_BACKWARD };\n}\n\nfunction turnRight(): GameAction {\n  return { type: ActionTypes.TURN_RIGHT };\n}\n\nfunction turnLeft(): GameAction {\n  return { type: ActionTypes.TURN_LEFT };\n}\n\nfunction move(direction: Direction): GameAction {\n  return {\n    type: ActionTypes.MOVE,\n    payload: direction\n  };\n}\n\n\nexport {\n  startLevel,\n  finishLevel,\n  moveForward,\n  moveBackward,\n  turnRight,\n  turnLeft,\n  move\n};\n","import { Cmd, loop } from 'redux-loop';\nimport {\n  Direction,\n  move as getNeighbor,\n  oppositeDirection,\n  rotateLeft,\n  rotateRight\n} from '../../../mechanics/directions';\nimport getRelevantTiles from '../../../mechanics/getRelevantTiles';\nimport isLevelCleared from '../../../mechanics/isLevelCleared';\nimport isMoveValid from '../../../mechanics/isMoveValid';\nimport pushObjects from '../../../mechanics/pushObjects';\nimport { LevelMap } from '../../../mechanics/types';\nimport { assertNever, Reducer } from '../../../utils/types';\nimport { levelsActions } from '../levels';\nimport { finishLevel, GameAction, move } from './actions';\nimport { ActionTypes, State } from './types';\n\n\nconst INITIAL_STATE: State = {\n  finished: false\n};\n\ntype TriggeredAction = GameAction | ReturnType<typeof levelsActions.clearLevel>;\n\nconst gameReducer: Reducer<State, GameAction, TriggeredAction> = (state = INITIAL_STATE, action) => {\n  if (action.type === ActionTypes.START_LEVEL) {\n    return {\n      finished: false,\n      ...action.payload\n    };\n  } else if (state.map) {\n    switch (action.type) {\n      case ActionTypes.MOVE_FORWARD: {\n        const direction = state.map.robot.direction;\n\n        if (canMove(state.map, direction)) {\n          return loop(state, Cmd.action(move(direction)));\n        }\n        return state;\n      }\n      case ActionTypes.MOVE_BACKWARD: {\n        const direction = oppositeDirection(state.map.robot.direction);\n\n        if (canMove(state.map, direction)) {\n          return loop(state, Cmd.action(move(direction)));\n        }\n        return state;\n      }\n      case ActionTypes.TURN_RIGHT:\n        return {\n          ...state,\n          map: {\n            ...state.map,\n            robot: {\n              position: state.map.robot.position,\n              direction: rotateRight(state.map.robot.direction)\n            }\n          }\n        };\n      case ActionTypes.TURN_LEFT:\n        return {\n          ...state,\n          map: {\n            ...state.map,\n            robot: {\n              position: state.map.robot.position,\n              direction: rotateLeft(state.map.robot.direction)\n            }\n          }\n        };\n      case ActionTypes.MOVE:\n        const newState = {\n          ...state,\n          map: {\n            ...state.map,\n            tiles: pushObjects(state.map.tiles, state.map.robot.position, action.payload),\n            robot: {\n              position: getNeighbor(state.map.robot.position, action.payload),\n              direction: state.map.robot.direction\n            }\n          }\n        };\n        if (isLevelCleared(newState.map)) {\n          return loop(newState, Cmd.action(finishLevel()));\n        }\n        return newState;\n      case ActionTypes.FINISH_LEVEL:\n        return loop(\n          { ...state, finished: true },\n          Cmd.action(levelsActions.clearLevel())\n        );\n      default:\n        assertNever(action);\n        return state;\n    }\n  } else {\n    return state;\n  }\n};\n\nfunction canMove(state: LevelMap, direction: Direction) {\n  const relevantTiles = getRelevantTiles(state.tiles, state.robot.position, direction);\n  return isMoveValid(...relevantTiles);\n}\n\n\nexport default gameReducer;\nexport { INITIAL_STATE };\n","import { Direction } from '../../../mechanics/directions';\nimport { Tile } from '../../../mechanics/types';\nimport { State } from './types';\n\n\nexport interface TileInfo extends Tile {\n  x: number;\n  y: number;\n  target: boolean;\n}\n\nfunction getRobotPosition(state: State): [number, number, number] {\n  if (!state.map) {\n    throw Error('Trying to get robot\\'s position before starting a game.');\n  }\n  const [x, y] = state.map.robot.position;\n  const height = state.map.tiles[x][y].height + state.map.tiles[x][y].objects.length + 1;\n\n  return [x, y, height];\n}\n\nfunction getRobotDirection(state: State): Direction {\n  if (!state.map) {\n    throw Error('Trying to get robot\\'s direction before starting a game.');\n  }\n  return state.map.robot.direction;\n}\n\nfunction getMapDimensions(state: State): [number, number] {\n  if (!state.map) {\n    throw Error('No map defined.');\n  }\n  return [state.map.width, state.map.height];\n}\n\nfunction getTilesInfo(state: State): TileInfo[] {\n  if (!state.map) {\n    throw Error('No map defined.');\n  }\n  const targets = new Set<string>();\n  const tilesInfo = [];\n\n  state.map.targets.forEach(point => {\n    targets.add(point.join(','));\n  });\n\n  for (let x = 0; x < state.map.width; x++) {\n    for (let y = 0; y < state.map.height; y++) {\n      tilesInfo.push({ x, y, target: targets.has(`${x},${y}`), ...state.map.tiles[x][y] });\n    }\n  }\n  return tilesInfo;\n}\n\n\nexport {\n  getRobotPosition,\n  getRobotDirection,\n  getMapDimensions,\n  getTilesInfo\n};\n","import reducer from './reducer';\nimport * as gameActions from './actions';\nimport * as gameSelectors from './selectors';\n\n\nexport {\n  gameActions,\n  gameSelectors\n};\n\n\nexport default reducer;\n","import { connectRouter } from 'connected-react-router';\nimport { History } from 'history';\nimport game from './game';\nimport levels from './levels';\nimport { combineReducers } from 'redux-loop';\nimport { State } from '../types';\n\n\nfunction createRootReducer(history: History) {\n  return combineReducers<State, any>({\n    game,\n    levels,\n    router: connectRouter(history)\n  });\n}\n\n\nexport default createRootReducer;\n","import { State } from './types';\nimport { Store } from 'redux';\n\n\n/**\n * Loads the specified state slices from local storage.\n */\nfunction loadPersistedState(slices: Array<keyof State>): Partial<State> {\n  const persistedState: Partial<State> = {};\n\n  slices.forEach(sliceName => {\n    try {\n      const serializedSliceState = localStorage.getItem(sliceName);\n\n      if (serializedSliceState) {\n        persistedState[sliceName] = JSON.parse(serializedSliceState);\n      }\n    } catch (err) {\n      console.warn(`Failed to load the state of slice \"${sliceName}\"`, err);\n    }\n  });\n  return persistedState;\n}\n\n/**\n * Persists the specified state slices to local storage.\n */\nfunction setupStatePersistence(store: Store<State>, slices: Array<keyof State>) {\n  let previousState = new Map(Object.entries(store.getState()));\n\n  store.subscribe(() => {\n    const newState = new Map(Object.entries(store.getState()));\n    const changedSlices = slices.filter(sliceName => newState.get(sliceName) !== previousState.get(sliceName));\n\n    changedSlices.forEach(sliceName => {\n      saveSliceState(sliceName, newState.get(sliceName)!);\n    });\n    if (changedSlices.length > 0) {\n      previousState = newState;\n    }\n  });\n}\n\n/**\n * Save the specified slice to local storage.\n */\nfunction saveSliceState<K extends keyof State>(sliceName: K, sliceState: State[K]) {\n  try {\n    const serializedSlice = JSON.stringify(sliceState);\n\n    localStorage.setItem(sliceName, serializedSlice);\n  } catch (err) {\n    console.warn(`Failed to persist the state of slice \"${sliceName}\"`, err);\n  }\n}\n\n\nexport {\n  loadPersistedState,\n  setupStatePersistence\n};\n","import { routerMiddleware } from 'connected-react-router';\nimport { createBrowserHistory } from 'history';\nimport { applyMiddleware, compose, createStore } from 'redux';\nimport { install, StoreCreator } from 'redux-loop';\nimport createRootReducer from './ducks';\nimport { loadPersistedState, setupStatePersistence } from './localStorage';\nimport { State } from './types';\n\n\nconst PERSISTENT_SLICES: Array<keyof State> = ['levels'];\n\nconst composeEnhancers = (window as any).__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ ?? compose;\n\nfunction configureStore() {\n  const persistedState = loadPersistedState(PERSISTENT_SLICES);\n  const history = createBrowserHistory({ basename: 'sokobot-3d' });\n  const enhancer = composeEnhancers(\n    applyMiddleware(routerMiddleware(history)),\n    install()\n  );\n  const enhancedCreateStore = createStore as StoreCreator;\n  const store = enhancedCreateStore(createRootReducer(history), persistedState as State, enhancer);\n\n  setupStatePersistence(store, PERSISTENT_SLICES);\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (module.hot) {\n      module.hot.accept('./ducks', () => {\n        store.replaceReducer(createRootReducer(history) as any);\n      });\n    }\n  }\n  return {\n    store,\n    history\n  };\n}\n\n\nexport {\n  configureStore\n};\n","import { goBack } from 'connected-react-router';\nimport { Button } from 'grommet';\nimport { Previous } from 'grommet-icons';\nimport React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { Dispatch } from 'redux';\n\n\ninterface BackButtonProps extends ConnectedProps<typeof connector> {\n}\n\nfunction BackButton({ goBack }: BackButtonProps) {\n  return <Button icon={<Previous/>} label=\"Back\" onClick={() => goBack()}/>;\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch) {\n  return {\n    goBack: () => dispatch(goBack())\n  };\n}\n\nconst connector = connect(null, mapDispatchToProps);\n\n\nexport default connector(BackButton);\nexport { BackButton };\n","import { Box } from 'grommet';\nimport React from 'react';\nimport styled from 'styled-components';\n\ninterface ScreenProps {\n  title: string;\n  children: React.ReactNode;\n}\n\nconst H1 = styled.h1`\n  text-align: center;\n`;\n\nfunction Screen({ title, children }: ScreenProps) {\n  return (\n    <Box width=\"medium\">\n      <header>\n        <H1>{title}</H1>\n      </header>\n      <Box width=\"medium\" gap=\"small\" align=\"stretch\">\n        {children}\n      </Box>\n    </Box>\n  );\n}\n\nexport default Screen;\n","import React from 'react';\nimport BackButton from '../BackButton';\nimport Screen from '../Screen';\n\n\nfunction Settings() {\n  return (\n    <Screen title=\"Settings\">\n      <BackButton/>\n    </Screen>\n  );\n}\n\n\nexport default Settings;\n","import { push } from 'connected-react-router';\nimport { Button } from 'grommet';\nimport { Play, SettingsOption } from 'grommet-icons';\nimport React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { Dispatch } from 'redux';\nimport Screen from '../Screen';\n\n\ninterface MenuProps extends ConnectedProps<typeof connector> {\n}\n\nfunction Menu({ startGame, openSettings }: MenuProps) {\n  return (\n    <Screen title=\"Sokobot\">\n      <Button icon={<Play/>} label=\"Start Game\" onClick={startGame}/>\n      <Button icon={<SettingsOption/>} label=\"Settings\" onClick={openSettings}/>\n    </Screen>\n  );\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch) {\n  return {\n    startGame: () => dispatch(push('/select-level')),\n    openSettings: () => dispatch(push('/settings'))\n  };\n}\n\nconst connector = connect(null, mapDispatchToProps);\n\n\nexport default connector(Menu);\nexport { Menu };\n","import { push } from 'connected-react-router';\nimport { Button } from 'grommet';\nimport { Lock, Unlock } from 'grommet-icons';\nimport React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { Dispatch } from 'redux';\nimport levels from '../../data/levels.json';\nimport { State } from '../../state/types';\nimport { levelsSelectors } from '../../state/ducks/levels';\nimport Screen from '../Screen';\n\n\ninterface LevelSelectionProps extends ConnectedProps<typeof connector> {\n}\n\nfunction LevelSelection({ isUnlocked, selectLevel }: LevelSelectionProps) {\n  return (\n    <Screen title=\"Select Level\">\n      {levels.map((_, level) => (\n        isUnlocked(level)\n          ? <Button key={level} label={`Level ${level + 1}`} icon={<Unlock/>} onClick={() => selectLevel(level)}/>\n          : <Button key={level} label={`Level ${level + 1}`} icon={<Lock/>} disabled={true}/>\n      ))}\n    </Screen>\n  );\n}\n\nfunction mapStateToProps(state: State) {\n  return {\n    isUnlocked: (level: number) => levelsSelectors.isUnlocked(state.levels, level)\n  };\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch) {\n  return {\n    selectLevel: (level: number) => dispatch(push(`/level/${level}`))\n  };\n}\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\n\nexport default connector(LevelSelection);\nexport { LevelSelection };\n","import React, { useEffect } from 'react';\n\n\n/**\n * Same as {@link useEffect}, but for side effects that should only happen once, when the component is first rendered.\n */\nfunction useEffectOnce(effect: React.EffectCallback) {\n  useEffect(effect, []);\n}\n\n\nexport default useEffectOnce;\n","import React, { useRef } from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { extend, useThree } from 'react-three-fiber';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { gameSelectors } from '../../state/ducks/game';\nimport { State } from '../../state/types';\nimport useEffectOnce from '../../utils/useEffectOnce';\n\n// False positive, when only the type is needed\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { ReactThreeFiber } from 'react-three-fiber';\n\n\nextend({ OrbitControls });\n\ndeclare global {\n  namespace JSX {\n    interface IntrinsicElements {\n      'orbitControls': ReactThreeFiber.Object3DNode<OrbitControls, typeof OrbitControls>;\n    }\n  }\n}\n\ninterface CameraControlsProps extends ConnectedProps<typeof connector> {\n}\n\nfunction CameraControls({ initialPosition }: CameraControlsProps) {\n  const { camera, gl } = useThree();\n  const controls = useRef<OrbitControls>();\n\n  useEffectOnce(() => {\n    if (initialPosition) {\n      camera.position.set(...initialPosition);\n      if (controls.current) {\n        controls.current.update();\n      }\n    }\n  });\n\n  return <orbitControls args={[camera, gl.domElement]} maxPolarAngle={Math.PI / 2} enablePan={false} ref={controls}/>;\n}\n\nfunction mapStateToProps(state: State) {\n  return {\n    // TODO: find a proper way to determine a good initial camera position\n    initialPosition: (() => {\n      try {\n        const mapDimensions = gameSelectors.getMapDimensions(state.game);\n        const n = Math.max(3, Math.max(...mapDimensions) * 0.7);\n\n        return [n, n, n] as const;\n      } catch {\n      }\n      return undefined;\n    })()\n  };\n}\n\nconst connector = connect(mapStateToProps);\n\n\nexport default connector(CameraControls);\nexport { CameraControls };\n","import React from 'react';\n\ninterface CardboardBoxProps {\n  x: number;\n  y: number;\n  height: number;\n}\n\nfunction CardboardBox({ x, y, height }: CardboardBoxProps) {\n  return (\n    <mesh position={[x, y, height]} castShadow={true} receiveShadow={true}>\n      <boxBufferGeometry attach=\"geometry\" args={[1, 1, 1]}/>\n      <meshLambertMaterial attach=\"material\" color={0xaa8844}/>\n    </mesh>\n  );\n}\n\n\nexport default CardboardBox;\n","import React from 'react';\n\n\ninterface GroundElevationProps {\n  x: number;\n  y: number;\n  height: number;\n}\n\nfunction GroundElevation({ x, y, height }: GroundElevationProps) {\n  return (\n    <mesh position={[x, y, (1 + height) / 2]} castShadow={true} receiveShadow={true}>\n      <boxBufferGeometry attach=\"geometry\" args={[1, 1, height]}/>\n      <meshPhongMaterial attach=\"material\" color={0x555555}/>\n    </mesh>\n  );\n}\n\n\nexport default GroundElevation;\n","import React, { useEffect } from 'react';\nimport { Dispatch } from 'redux';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { gameActions, gameSelectors } from '../../state/ducks/game';\nimport { State } from '../../state/types';\nimport { directionToAngle } from '../../mechanics/directions';\n\n\ninterface RobotProps extends ConnectedProps<typeof connector> {\n}\n\nfunction Robot({ position, direction, ...actions }: RobotProps) {\n  function onKeyPress(event: KeyboardEvent) {\n    switch (event.key) {\n      case 'w':\n        actions.moveForward();\n        break;\n      case 'd':\n        actions.turnRight();\n        break;\n      case 's':\n        actions.moveBackward();\n        break;\n      case 'a':\n        actions.turnLeft();\n        break;\n    }\n  }\n\n  useEffect(() => {\n    window.addEventListener('keypress', onKeyPress);\n    return () => {\n      window.removeEventListener('keypress', onKeyPress);\n    };\n  });\n\n  return (\n    <mesh position={position} rotation={[0, 0, direction]} castShadow={true} receiveShadow={true}>\n      <coneBufferGeometry attach=\"geometry\" args={[0.5, 1, 10]}/>\n      <meshLambertMaterial attach=\"material\" color={0x6A0BFF}/>\n    </mesh>\n  );\n}\n\nfunction mapStateToProps(state: State) {\n  return {\n    position: gameSelectors.getRobotPosition(state.game),\n    direction: directionToAngle(gameSelectors.getRobotDirection(state.game))\n  }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch) {\n  return {\n    moveForward: () => dispatch(gameActions.moveForward()),\n    moveBackward: () => dispatch(gameActions.moveBackward()),\n    turnRight: () => dispatch(gameActions.turnRight()),\n    turnLeft: () => dispatch(gameActions.turnLeft())\n  };\n}\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\n\nexport default connector(Robot);\nexport { Robot };\n","import React from 'react';\n\n\ninterface TargetTileProps {\n  x: number;\n  y: number;\n  height: number;\n}\n\nfunction TargetTile({ x, y, height }: TargetTileProps) {\n  return (\n    <mesh position={[x, y, height + .51]} receiveShadow={true}>\n      <planeBufferGeometry attach=\"geometry\" args={[1, 1]}/>\n      <meshLambertMaterial attach=\"material\" color={0x00FF00}/>\n    </mesh>\n  );\n}\n\n\nexport default TargetTile;\n","import React, { Fragment } from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { gameSelectors } from '../../state/ducks/game';\nimport { State } from '../../state/types';\nimport CardboardBox from './CardboardBox';\nimport GroundElevation from './GroundElevation';\nimport Robot from './Robot';\nimport TargetTile from './TargetTile';\n\n\ninterface MapProps extends ConnectedProps<typeof connector> {\n}\n\nfunction Map({ mapDimensions, tilesInfo }: MapProps) {\n  const [xSize, ySize] = mapDimensions;\n\n  return (\n    <group position={[(1 - xSize) / 2, (1 - ySize) / 2, -.5]}>\n      <Robot/>\n      {tilesInfo.map(({ x, y, height, objects, target }) => (\n        <Fragment key={`${x}-${y}`}>\n          {height > 0 && <GroundElevation x={x} y={y} height={height}/>}\n          {objects.map((object, index) => (\n            <CardboardBox key={`${x}-${y}-${index}`} x={x} y={y} height={height + index + 1}/>\n          ))}\n          {target && <TargetTile x={x} y={y} height={height}/>}\n        </Fragment>\n      ))}\n    </group>\n  );\n}\n\nfunction mapStateToProps(state: State) {\n  return {\n    mapDimensions: gameSelectors.getMapDimensions(state.game),\n    tilesInfo: gameSelectors.getTilesInfo(state.game)\n  };\n}\n\nconst connector = connect(mapStateToProps);\n\n\nexport default connector(Map);\nexport { Map };\n","import React from 'react';\nimport { ReactReduxContext, Provider } from 'react-redux';\nimport { Canvas } from 'react-three-fiber';\nimport { AxesHelper } from 'react-three-fiber/components';\nimport { Color } from 'three';\nimport CameraControls from './CameraControls';\nimport Map from './Map';\n\n\nfunction MyCanvas() {\n  return (\n    <ReactReduxContext.Consumer>\n      {({ store }) => (\n        <Canvas shadowMap style={{ backgroundColor: 'black', height: '100%', position: 'absolute', top: 0, left: 0 }}>\n          <Provider store={store}>\n            <CameraControls/>\n            <group rotation={[-Math.PI / 2, 0, 0]}>\n              {process.env.NODE_ENV !== 'production' && <AxesHelper scale={[10, 10, 10]}/>}\n              <ambientLight intensity={0.3}/>\n              <spotLight\n                color={new Color('#fffda7')}\n                castShadow\n                intensity={0.7}\n                penumbra={1}\n                decay={1}\n                angle={Math.PI / 8}\n                position={[10, 10, 10]}\n                shadow-mapSize-width={2048}\n                shadow-mapSize-height={2048}\n              />\n              <Map/>\n            </group>\n          </Provider>\n        </Canvas>\n      )}\n    </ReactReduxContext.Consumer>\n  );\n}\n\n\nexport default MyCanvas;\n","import { Box, Button } from 'grommet';\nimport { LinkDown, LinkUp, RotateLeft, RotateRight } from 'grommet-icons';\nimport React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { Dispatch } from 'redux';\nimport styled from 'styled-components';\nimport { gameActions } from '../../../state/ducks/game';\n\n\ninterface ControlsProps extends ConnectedProps<typeof connector> {\n}\n\nfunction Controls({ moveForward, moveBackward, turnLeft, turnRight }: ControlsProps) {\n  return (\n    <Wrapper>\n      <Box align=\"center\">\n        <IconButton icon={<LinkUp/>} title=\"Move forward\" onClick={moveForward}/>\n      </Box>\n      <Box direction=\"row\">\n        <IconButton icon={<RotateLeft/>} title=\"Turn left\" onClick={turnLeft}/>\n        <IconButton icon={<LinkDown/>} title=\"Move backward\" onClick={moveBackward}/>\n        <IconButton icon={<RotateRight/>} title=\"Turn right\" onClick={turnRight}/>\n      </Box>\n    </Wrapper>\n  );\n}\n\nconst Wrapper = styled.div`\n  position: fixed;\n  bottom: .5rem;\n  right: .5rem;\n  z-index: 1000;\n`;\n\ninterface IconButtonProps {\n  icon: JSX.Element;\n  title: string;\n  onClick: () => void;\n}\n\nfunction IconButton(props: IconButtonProps) {\n  return <Button {...props} plain={false} margin=\"xxsmall\"/>;\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch) {\n  return {\n    moveForward: () => dispatch(gameActions.moveForward()),\n    moveBackward: () => dispatch(gameActions.moveBackward()),\n    turnLeft: () => dispatch(gameActions.turnLeft()),\n    turnRight: () => dispatch(gameActions.turnRight())\n  };\n}\n\nconst connector = connect(null, mapDispatchToProps);\n\n\nexport default connector(Controls);\nexport { Controls };\n","import { push } from 'connected-react-router';\nimport { Box, Button } from 'grommet';\nimport React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { Dispatch } from 'redux';\nimport styled from 'styled-components';\nimport { State } from '../../../state/types';\n\n\ninterface LevelClearedDialogProps extends ConnectedProps<typeof connector> {\n  nextLevel: number | undefined;\n}\n\nconst DialogWrapper = styled.div`\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 1000;\n  background-color: rgba(0, 0, 0, 0.3);\n  border-radius: 1em;\n  h1 {\n    text-align: center;\n  }\n`;\n\nfunction LevelClearedDialog({ isLevelCleared, nextLevel, goToLevel, goToLevelSelection }: LevelClearedDialogProps) {\n  if (isLevelCleared) {\n    return (\n      <DialogWrapper>\n        <Box width=\"medium\" gap=\"small\" align=\"stretch\" pad=\"small\">\n          <h1>{nextLevel ? 'Level Cleared' : 'Game Cleared'}</h1>\n          {nextLevel !== undefined && <Button label=\"Go to next level\" onClick={() => goToLevel(nextLevel)}/>}\n          <Button label=\"Back to level selection\" onClick={goToLevelSelection}/>\n        </Box>\n      </DialogWrapper>\n    );\n  }\n  return null;\n}\n\nfunction mapStateToProps(state: State) {\n  return {\n    isLevelCleared: state.game.finished\n  };\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch) {\n  return {\n    goToLevel: (level: number) => dispatch(push(`/level/${level}`)),\n    goToLevelSelection: () => dispatch(push('/select-level'))\n  };\n}\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\n\nexport default connector(LevelClearedDialog);\nexport { LevelClearedDialog };\n","import { Button } from 'grommet';\nimport { Refresh } from 'grommet-icons';\nimport React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { Dispatch } from 'redux';\nimport styled from 'styled-components';\nimport { levelsActions, levelsSelectors } from '../../../state/ducks/levels';\nimport { State } from '../../../state/types';\n\n\ninterface RestartButtonProps extends ConnectedProps<typeof connector> {\n}\n\nfunction RestartButton({ level, restart }: RestartButtonProps) {\n  return (\n    <Wrapper>\n      <Button label=\"Restart\" icon={<Refresh/>} onClick={() => restart(level)}/>\n    </Wrapper>\n  );\n}\n\nconst Wrapper = styled.div`\n  position: fixed;\n  top: .5rem;\n  left: .5rem;\n  z-index: 1000;\n`;\n\nfunction mapStateToProps(state: State) {\n  return {\n    level: levelsSelectors.getSelectedLevel(state.levels)!\n  };\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch) {\n  return {\n    restart: (level: number) => dispatch(levelsActions.selectLevel(level))\n  };\n}\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\n\nexport default connector(RestartButton);\nexport { RestartButton };\n","import React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { Redirect, RouteComponentProps } from 'react-router';\nimport levels from '../../../data/levels.json';\nimport { levelsSelectors } from '../../../state/ducks/levels';\nimport { State } from '../../../state/types';\nimport Screen from '../../Screen';\nimport MyCanvas from '../../webgl/MyCanvas';\nimport Controls from './Controls';\nimport LevelClearedDialog from './LevelClearedDialog';\nimport RestartButton from './RestartButton';\n\n\ninterface MatchParams {\n  level: string;\n}\n\ninterface LevelProps extends RouteComponentProps<MatchParams>, ConnectedProps<typeof connector> {\n}\n\nfunction Level({ match, isUnlocked }: LevelProps) {\n  const level = +match.params.level;\n  const levelData = levels[level];\n  //TODO: create levelsSelectors.getNextLevel() and move this to LevelClearedDialog\n  const nextLevel = levels[level + 1] ? level + 1 : undefined;\n\n  if (!levelData || !isUnlocked(level)) {\n    return <Redirect to=\"/select-level\"/>;\n  }\n  return (\n    <Screen title={levelData.name}>\n      <MyCanvas/>\n      <Controls/>\n      <RestartButton/>\n      <LevelClearedDialog nextLevel={nextLevel}/>\n    </Screen>\n  );\n}\n\nfunction mapStateToProps(state: State) {\n  return {\n    isUnlocked: (level: number) => levelsSelectors.isUnlocked(state.levels, level)\n  };\n}\n\nconst connector = connect(mapStateToProps);\n\n\nexport default connector(Level);\nexport { Level };\n","import Level from './Level';\n\nexport default Level;\n","import { ThemeType } from 'grommet';\nimport { DeepPartial } from 'utility-types';\n\n\nconst theme: DeepPartial<ThemeType> = {\n  global: {\n    colors: {\n      icon: {\n        dark: 'text'\n      },\n      brand: '#7D4CDB',\n      control: 'brand',\n      text: '#aaa',\n      background: '#000'\n    },\n    font: {\n      family: 'Arial'\n    }\n  }\n};\n\n\nexport default theme;\n","import React from 'react';\nimport { Grommet, Main, ThemeType } from 'grommet';\nimport { configureStore } from '../state/store';\nimport { Provider } from 'react-redux';\nimport { ConnectedRouter } from 'connected-react-router';\nimport { Redirect, Route, Switch } from 'react-router';\nimport Settings from './screens/Settings';\nimport Menu from './screens/Menu';\nimport LevelSelection from './screens/LevelSelection';\nimport Level from './screens/Level';\nimport theme from '../theme';\n\n\nconst { store, history } = configureStore();\n\nfunction App() {\n  return (\n    <Provider store={store}>\n      <ConnectedRouter history={history}>\n        <Grommet full theme={theme as ThemeType}>\n          <Main align=\"center\">\n            <Switch>\n              <Route exact path=\"/\" component={Menu}/>\n              <Route exact path=\"/settings\" component={Settings}/>\n              <Route exact path=\"/select-level\" component={LevelSelection}/>\n              <Route exact path=\"/level/:level\" component={Level}/>\n              <Route render={() => <Redirect to=\"/\"/>}/>\n            </Switch>\n          </Main>\n        </Grommet>\n      </ConnectedRouter>\n    </Provider>\n  );\n}\n\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// CRA docs about PWA: https://create-react-app.dev/docs/making-a-progressive-web-app/\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './components/App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\nserviceWorker.register();\n"],"sourceRoot":""}