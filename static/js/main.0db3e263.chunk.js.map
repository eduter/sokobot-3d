{"version":3,"sources":["mechanics/directions.ts","mechanics/getRelevantTiles.ts","mechanics/isLevelCleared.ts","mechanics/isMoveValid.ts","mechanics/pushObjects.ts","state/ducks/levels/types.ts","levels.ts","state/ducks/levels/actions.ts","state/ducks/levels/selectors.ts","state/ducks/levels/reducer.ts","state/ducks/game/types.ts","state/ducks/levels/index.ts","state/ducks/game/actions.ts","state/ducks/game/reducer.ts","state/ducks/game/selectors.ts","state/ducks/game/index.ts","state/ducks/settings/types.ts","state/ducks/settings/reducer.ts","state/ducks/settings/actions.ts","state/ducks/settings/selectors.ts","state/ducks/settings/index.ts","state/ducks/index.ts","state/localStorage.ts","state/store.ts","components/BackButton.tsx","components/Screen.tsx","components/screens/Settings.tsx","components/screens/Menu.tsx","components/screens/LevelSelection.tsx","utils/hooks/useEffectOnce.ts","utils/hooks/useMinimalRotation.ts","utils/hooks/usePrevious.ts","utils/hooks/useSimpleMovementAnimation.ts","components/webgl/CameraControls.tsx","components/webgl/CardboardBox.tsx","components/webgl/GroundElevation.tsx","components/webgl/Robot.tsx","components/webgl/TargetTile.tsx","components/webgl/Map.tsx","components/webgl/MyCanvas.tsx","components/screens/Level/GameControls.tsx","components/screens/Level/LevelClearedDialog.tsx","components/screens/Level/RestartButton.tsx","components/screens/Level/Level.tsx","components/screens/Level/index.ts","theme.ts","components/App.tsx","serviceWorker.ts","index.tsx"],"names":["Direction","rightAngle","Math","PI","DIRECTIONS","NORTH","dx","dy","angle","WEST","SOUTH","EAST","rightOf","leftOf","move","point","direction","x","y","rotateRight","rotateLeft","oppositeDirection","getTile","tiles","undefined","getRelevantTiles","robotPosition","moveDirection","targetPosition","pushedObjectsPosition","isLevelCleared","levelMap","hasBox","tile","objects","some","o","type","targets","column","targetX","targetY","isValidTile","height","isMoveValid","currentTile","targetTile","pushedObectsTile","length","slice","pushObjects","from","robotX","robotY","fromX","fromY","toX","toY","robotTile","map","fromTile","ActionTypes","levels","width","robot","position","getLevelNames","_","index","getLevelMap","level","robotZ","key","createUniqueKey","obj","addKeys","initialX","initialY","initialZ","join","selectLevel","SELECT_LEVEL","payload","clearLevel","CLEAR_LEVEL","getSelectedLevel","state","selectedLevel","isUnlocked","unlockedLevels","getNextLevel","nextLevel","INITIAL_STATE","parseLevel","path","startsWith","parseInt","substr","levelsReducer","reducer","action","LOCATION_CHANGE","location","pathname","loop","Cmd","gameActions","startLevel","START_LEVEL","finishLevel","FINISH_LEVEL","moveForward","MOVE_FORWARD","moveBackward","MOVE_BACKWARD","turnRight","TURN_RIGHT","turnLeft","TURN_LEFT","MOVE","finished","canMove","relevantTiles","getRobotPosition","assertMapDefined","getRobotDirection","getRobotKey","getMapDimensions","getTilesInfo","Set","tilesInfo","hasTarget","has","push","getMovableObjectsInfo","allObjects","tileObjects","Error","newState","getNeighbor","levelsActions","onScreenControls","toggleOnScreenControls","TOGGLE_ON_SCREEN_CONTROLS","displayOnScreenControls","createRootReducer","history","combineReducers","game","settings","router","connectRouter","setupStatePersistence","store","slices","previousState","Map","Object","entries","getState","subscribe","changedSlices","filter","sliceName","get","forEach","sliceState","serializedSlice","JSON","stringify","localStorage","setItem","err","console","warn","saveSliceState","PERSISTENT_SLICES","composeEnhancers","window","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","connector","connect","dispatch","goBack","Button","icon","Previous","label","onClick","H1","styled","h1","Screen","title","children","Box","gap","align","settingsSelectors","settingsActions","CheckBox","checked","onChange","startGame","openSettings","Play","SettingsOption","levelsSelectors","levelName","Unlock","Lock","disabled","useEffectOnce","effect","useEffect","useMinimalRotation","currentDirection","ref","useRef","previousAngle","current","currentAngle","fullRotation","directionDiff","minimizeRotation","usePrevious","currentValue","useSimpleMovementAnimation","currentProps","previousProps","useSpring","to","next","a","config","duration","extend","OrbitControls","initialPosition","mapDimensions","gameSelectors","n","max","useThree","camera","gl","controls","set","update","args","domElement","maxPolarAngle","enablePan","CardboardBox","props","mesh","castShadow","receiveShadow","attach","color","GroundElevation","zRotation","rotation","TargetTile","movableObjectsInfo","robotKey","xSize","ySize","MyCanvas","Consumer","shadowMap","style","backgroundColor","top","left","process","intensity","Color","penumbra","decay","shadow-mapSize-width","shadow-mapSize-height","Wrapper","div","IconButton","plain","margin","keyMapping","onKeyPress","W","A","S","D","event","toUpperCase","call","addEventListener","removeEventListener","LinkUp","RotateLeft","LinkDown","RotateRight","DialogWrapper","goToLevel","goToLevelSelection","message","pad","restart","Refresh","Level","match","params","theme","global","colors","dark","brand","control","text","background","font","family","persistedState","serializedSliceState","getItem","parse","loadPersistedState","createBrowserHistory","basename","enhancer","applyMiddleware","routerMiddleware","install","enhancedCreateStore","createStore","configureStore","App","Grommet","full","Main","exact","component","Menu","Settings","LevelSelection","render","isLocalhost","Boolean","hostname","registerValidSW","swUrl","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","log","onUpdate","onSuccess","catch","error","ReactDOM","document","getElementById","URL","href","origin","fetch","headers","response","contentType","status","indexOf","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.0db3e263.chunk.js","sourcesContent":["export type Point2D = [number, number];\n\nenum Direction {\n  NORTH = 'NORTH',\n  EAST = 'EAST',\n  SOUTH = 'SOUTH',\n  WEST = 'WEST'\n}\n\nconst rightAngle = Math.PI / 2;\n\nconst DIRECTIONS = {\n  NORTH: { dx: 0, dy: 1, angle: 0 },\n  WEST: { dx: -1, dy: 0, angle: rightAngle },\n  SOUTH: { dx: 0, dy: -1, angle: 2 * rightAngle },\n  EAST: { dx: 1, dy: 0, angle: 3 * rightAngle }\n} as const;\n\nconst rightOf: Record<Direction, Direction> = {\n  [Direction.NORTH]: Direction.EAST,\n  [Direction.EAST]: Direction.SOUTH,\n  [Direction.SOUTH]: Direction.WEST,\n  [Direction.WEST]: Direction.NORTH\n};\n\nconst leftOf: Record<Direction, Direction> = {\n  [Direction.NORTH]: Direction.WEST,\n  [Direction.WEST]: Direction.SOUTH,\n  [Direction.SOUTH]: Direction.EAST,\n  [Direction.EAST]: Direction.NORTH\n};\n\nfunction move(point: Point2D, direction: Direction): Point2D {\n  const [x, y] = point;\n  const { dx, dy } = DIRECTIONS[direction];\n\n  return [x + dx, y + dy];\n}\n\nfunction rotateRight(direction: Direction): Direction {\n  return rightOf[direction];\n}\n\nfunction rotateLeft(direction: Direction): Direction {\n  return leftOf[direction];\n}\n\nfunction oppositeDirection(direction: Direction): Direction {\n  return rightOf[rightOf[direction]];\n}\n\nfunction directionToAngle(direction: Direction): number {\n  return DIRECTIONS[direction].angle;\n}\n\n/**\n * Finds the angle that minimizes the rotation needed to go from one angle to a given direction.\n *\n * @param previousAngle - an angle in radians (may be negative or well over 2 * PI)\n * @param currentDirection - an angle (in radians) indicating the direction of the result, within a circumference\n * @return the closest angle to {@param previousAngle}, which points in the same direction as the angle\n *    {@param currentDirection}\n */\nfunction minimizeRotation(previousAngle: number, currentDirection: number): number {\n  const fullRotation = 2 * Math.PI;\n  const directionDiff = (currentDirection - previousAngle) % fullRotation;\n\n  if (directionDiff > Math.PI) {\n    return previousAngle + directionDiff - fullRotation;\n  } else if (directionDiff < -Math.PI) {\n    return previousAngle + directionDiff + fullRotation;\n  }\n  return previousAngle + directionDiff;\n}\n\nexport {\n  Direction,\n  move,\n  rotateRight,\n  rotateLeft,\n  oppositeDirection,\n  directionToAngle,\n  minimizeRotation\n};\n","import { Maybe } from '../utils/types';\nimport { Direction, move, Point2D } from './directions';\nimport { Tile } from './types';\n\n\nfunction getRelevantTiles(tiles: Tile[][], robotPosition: Point2D, moveDirection: Direction) {\n  const targetPosition = move(robotPosition, moveDirection);\n  const pushedObjectsPosition = move(targetPosition, moveDirection);\n\n  return [\n    getTile(tiles, robotPosition),\n    getTile(tiles, targetPosition),\n    getTile(tiles, pushedObjectsPosition)\n  ] as [Tile, Maybe<Tile>, Maybe<Tile>];\n}\n\nfunction getTile(tiles: Tile[][], [x, y]: Point2D): Maybe<Tile> {\n  return tiles[x] ? tiles[x][y] : undefined;\n}\n\n\nexport default getRelevantTiles;\n","import { LevelMap, Tile } from './types';\n\n\nfunction isLevelCleared(levelMap: LevelMap): boolean {\n  const hasBox = (tile: Tile) => tile.objects.some(o => o.type === 'box');\n\n  // checks for a target without a box\n  if (levelMap.targets.some(([x, y]) => !hasBox(levelMap.tiles[x][y]))) {\n    return false;\n  }\n\n  // checks for a box without a target\n  return !levelMap.tiles.some((column, x) => (\n    column.some((tile, y) => (\n      hasBox(tile) && !levelMap.targets.some(([targetX, targetY]) => targetX === x && targetY === y)\n    ))\n  ));\n}\n\n\nexport default isLevelCleared;\n","import { Maybe } from '../utils/types';\nimport { Tile } from './types';\n\n\nfunction isMoveValid(currentTile: Tile, targetTile: Maybe<Tile>, pushedObectsTile: Maybe<Tile>): boolean {\n  if (!isValidTile(targetTile)) {\n    // target is beyond the edge or is a hole\n    return false;\n  } else if (targetTile.height > currentTile.height + currentTile.objects.length) {\n    // trying to move toward a wall\n    return false;\n  }\n\n  const height = currentTile.height + currentTile.objects.length;\n  const pushedObjects = targetTile.objects.slice(height - targetTile.height);\n\n  if (pushedObjects.length > 0) {\n    if (!isValidTile(pushedObectsTile)) {\n      // trying to push objects into the void\n      return false;\n    } else if (pushedObectsTile.height + pushedObectsTile.objects.length > height) {\n      // trying to push objects into a wall/object\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction isValidTile(tile: Maybe<Tile>): tile is Tile {\n  return tile !== undefined && tile.height > 0;\n}\n\n\nexport default isMoveValid;\n","import { Direction, move, Point2D } from './directions';\nimport { Tile } from './types';\n\n\nfunction pushObjects(tiles: Tile[][], robotPosition: Point2D, direction: Direction): Tile[][] {\n  const from = move(robotPosition, direction);\n  const [robotX, robotY] = robotPosition;\n  const [fromX, fromY] = from;\n  const [toX, toY] = move(from, direction);\n  const robotTile = tiles[robotX][robotY];\n  const height = robotTile.height + robotTile.objects.length;\n\n  return tiles.map((column, x) => (\n    column.map((tile, y) => {\n      if (x === fromX && y === fromY) {\n        return {\n          ...tile,\n          objects: tile.objects.slice(0, height - tile.height)\n        };\n      } else if (x === toX && y === toY) {\n        const fromTile = tiles[fromX][fromY];\n        return {\n          ...tile,\n          objects: [...tile.objects, ...fromTile.objects.slice(height - fromTile.height)]\n        };\n      }\n      return tile;\n    })\n  ))\n}\n\n\nexport default pushObjects;\n","import { DeepReadonly } from 'utility-types';\n\n\nexport enum ActionTypes {\n  SELECT_LEVEL = 'levels/SELECT_LEVEL',\n  CLEAR_LEVEL = 'levels/CLEAR_LEVEL',\n}\n\nexport type State = DeepReadonly<{\n  readonly unlockedLevels: number;\n  readonly selectedLevel?: number;\n}>;\n","import { LevelMap } from './mechanics/types';\nimport { Maybe } from './utils/types';\nimport { Direction } from './mechanics/directions';\n\n\nconst levels: LevelMap[] = [\n  // 1 move\n  {\n    height: 3,\n    width: 3,\n    targets: [[1, 2]],\n    tiles: [\n      [{ height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }],\n      [{ height: 1, objects: [] }, { height: 1, objects: [{ type: 'box' }] }, { height: 1, objects: [] }],\n      [{ height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }]\n    ],\n    robot: {\n      position: [1, 0],\n      direction: Direction.NORTH\n    }\n  },\n  // 2nd 2D\n  {\n    height: 4,\n    width: 5,\n    targets: [[0, 1], [4, 0]],\n    tiles: [\n      [{ height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }],\n      [{ height: 1, objects: [{ type: 'box' }] }, { height: 0, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }],\n      [{ height: 1, objects: [] }, { height: 1, objects: [{ type: 'box' }] }, { height: 1, objects: [] }, { height: 1, objects: [] }],\n      [{ height: 1, objects: [] }, { height: 0, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }],\n      [{ height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }]\n    ],\n    robot: {\n      position: [2, 0],\n      direction: Direction.NORTH\n    }\n  },\n  // 1st 3D\n  {\n    height: 5,\n    width: 5,\n    targets: [[0, 0], [4, 4]],\n    tiles: [\n      [{ height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }],\n      [{ height: 1, objects: [] }, { height: 0, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }],\n      [{ height: 1, objects: [] }, { height: 2, objects: [] }, { height: 2, objects: [] }, { height: 1, objects: [{ type: 'box' }, { type: 'box' }] }, { height: 1, objects: [] }],\n      [{ height: 1, objects: [] }, { height: 2, objects: [] }, { height: 2, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }],\n      [{ height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }]\n    ],\n    robot: {\n      position: [2, 2],\n      direction: Direction.NORTH\n    }\n  },\n  // 2nd 3D\n  {\n    height: 3,\n    width: 5,\n    targets: [[0, 2], [4, 2]],\n    tiles: [\n      [{ height: 1, objects: [] },{ height: 1, objects: [] },{ height: 1, objects: []}],\n      [{ height: 2, objects: [] },{ height: 2, objects: [{ type: 'box' }] },{ height: 1, objects: [{ type: 'box' }]}],\n      [{ height: 2, objects: [] },{ height: 2, objects: [{ type: 'box' }] },{ height: 1, objects: []}],\n      [{ height: 2, objects: [] },{ height: 2, objects: [{ type: 'box' }] },{ height: 1, objects: []}],\n      [{ height: 1, objects: [] },{ height: 1, objects: [] },{ height: 1, objects: []}]\n    ],\n    robot: {\n      position: [2, 0],\n      direction: Direction.NORTH\n    }\n },\n  // 3rd 3D\n  {\n    height: 6,\n    width: 5,\n    tiles: [\n      [{ height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }],\n      [{ height: 2, objects: [] }, { height: 2, objects: [{ type: 'box' }] }, { height: 1, objects: [] }, { height: 1, objects: [] }, { height: 2, objects: [] }, { height: 2, objects: [] }],\n      [{ height: 2, objects: [] }, { height: 2, objects: [{ type: 'box' }] }, { height: 1, objects: [] }, { height: 1, objects: [] }, { height: 2, objects: [{ type: 'box' }] }, { height: 2, objects: [] }],\n      [{ height: 2, objects: [] }, { height: 2, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }, { height: 2, objects: [{ type: 'box' }] }, { height: 2, objects: [] }],\n      [{ height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }, { height: 1, objects: [] }]\n    ],\n    targets: [[0, 2], [0, 3], [4, 0], [4, 5]],\n    robot: {\n      position: [2, 0],\n      direction: Direction.NORTH\n    }\n  }\n];\n\n/**\n * Lists the names of all levels.\n * (levels may have have meaningful names later on)\n */\nfunction getLevelNames(): string[] {\n  return levels.map((_, index) => `Level ${index + 1}`);\n}\n\n/**\n * Returns a copy of a level's map, given its index.\n */\nfunction getLevelMap(level: number): Maybe<LevelMap> {\n  const map = levels[level];\n\n  if (map) {\n    return addKeys(level, map);\n  }\n  return undefined;\n}\n\n/**\n * Returns a copy of a map, adding unique keys to robot and movable objects.\n */\nfunction addKeys(level: number, map: LevelMap): LevelMap {\n  const [robotX, robotY] = map.robot.position;\n  const robotTile = map.tiles[robotX][robotY];\n  const robotZ = robotTile.height + robotTile.objects.length;\n\n  return {\n    ...map,\n    robot: {\n      ...map.robot,\n      key: createUniqueKey(level, robotX, robotY, robotZ)\n    },\n    tiles: map.tiles.map((column, x) => (\n      column.map(({ height, objects }, y) => ({\n        height,\n        objects: objects.map((obj, index) => ({\n          ...obj,\n          key: createUniqueKey(level, x, y, height + 1 + index)\n        }))\n      }))\n    ))\n  };\n}\n\n/**\n * Creates a deterministic unique key for an object, based on its level and initial position.\n */\nfunction createUniqueKey(level: number, initialX: number, initialY: number, initialZ: number): string {\n  return [level, initialX, initialY, initialZ].join('-');\n}\n\n\nexport {\n  getLevelNames,\n  getLevelMap\n};\n","import { Action } from '../../../utils/types';\nimport { ActionTypes } from './types';\n\n\nexport type LevelsAction = (\n  Action<ActionTypes.SELECT_LEVEL, { level: number }>\n  | Action<ActionTypes.CLEAR_LEVEL>\n);\n\nfunction selectLevel(level: number): LevelsAction {\n  return {\n    type: ActionTypes.SELECT_LEVEL,\n    payload: {\n      level\n    }\n  };\n}\n\nfunction clearLevel(): LevelsAction {\n  return { type: ActionTypes.CLEAR_LEVEL };\n}\n\n\nexport {\n  selectLevel,\n  clearLevel\n};\n","import { getLevelNames } from '../../../levels';\nimport { Maybe } from '../../../utils/types';\nimport { State } from './types';\n\n\nfunction getSelectedLevel(state: State) {\n  return state.selectedLevel;\n}\n\nfunction isUnlocked(state: State, level: number) {\n  return level < state.unlockedLevels;\n}\n\nfunction getNextLevel(state: State): Maybe<number> {\n  if (state.selectedLevel !== undefined) {\n    const nextLevel = state.selectedLevel + 1;\n\n    if (nextLevel in getLevelNames()) {\n      return nextLevel;\n    }\n  }\n  return undefined;\n}\n\n\nexport {\n  getSelectedLevel,\n  isUnlocked,\n  getNextLevel\n};\n","import { LOCATION_CHANGE, LocationChangeAction } from 'connected-react-router';\nimport { Cmd, loop } from 'redux-loop';\nimport { getLevelMap } from '../../../levels';\nimport { assertNever, Maybe, Reducer } from '../../../utils/types';\nimport { gameActions } from '../game';\nimport { LevelsAction, selectLevel } from './actions';\nimport { isUnlocked } from './selectors';\nimport { ActionTypes, State } from './types';\n\n\nconst INITIAL_STATE: State = {\n  unlockedLevels: 1\n};\n\ntype HandledAction = LevelsAction | LocationChangeAction;\ntype TriggeredAction = LevelsAction | ReturnType<typeof gameActions.startLevel>;\n\nconst levelsReducer: Reducer<State, HandledAction, TriggeredAction> = (state = INITIAL_STATE, action) => {\n  switch (action.type) {\n    case LOCATION_CHANGE: {\n      const level = parseLevel(action.payload.location.pathname);\n\n      if (level !== undefined) {\n        return loop(\n          state,\n          Cmd.action(selectLevel(level))\n        );\n      }\n      return state;\n    }\n    case ActionTypes.SELECT_LEVEL: {\n      const { level } = action.payload;\n      const levelMap = getLevelMap(level);\n\n      if (levelMap && isUnlocked(state, level)) {\n        return loop(\n          { ...state, selectedLevel: level },\n          Cmd.action(gameActions.startLevel(levelMap))\n        );\n      }\n      return state;\n    }\n    case ActionTypes.CLEAR_LEVEL:\n      return {\n        ...state,\n        unlockedLevels: state.unlockedLevels + (state.selectedLevel === state.unlockedLevels - 1 ? 1 : 0)\n      };\n    default:\n      assertNever(action);\n      return state;\n  }\n};\n\nfunction parseLevel(path: string): Maybe<number> {\n  const prefix = '/level/';\n\n  if (!path.startsWith(prefix)) {\n    return undefined;\n  }\n  return parseInt(path.substr(prefix.length));\n}\n\n\nexport default levelsReducer;\n","import { LevelMap } from '../../../mechanics/types';\n\n\nexport enum ActionTypes {\n  START_LEVEL = 'game/START_LEVEL',\n  FINISH_LEVEL = 'game/FINISH_LEVEL',\n  MOVE = 'game/MOVE',\n  MOVE_FORWARD = 'game/MOVE_FORWARD',\n  MOVE_BACKWARD = 'game/MOVE_BACKWARD',\n  TURN_RIGHT = 'game/TURN_RIGHT',\n  TURN_LEFT = 'game/TURN_LEFT'\n}\n\nexport interface State {\n  finished: boolean;\n  map?: LevelMap;\n}\n","import reducer from './reducer';\nimport * as levelsActions from './actions';\nimport * as levelsSelectors from './selectors';\n\n\nexport {\n  levelsActions,\n  levelsSelectors\n};\n\n\nexport default reducer;\n","import { Direction } from '../../../mechanics/directions';\nimport { LevelMap } from '../../../mechanics/types';\nimport { Action } from '../../../utils/types';\nimport { ActionTypes } from './types';\n\n\nexport type GameAction = (\n  Action<ActionTypes.START_LEVEL, { map: LevelMap }>\n  | Action<ActionTypes.FINISH_LEVEL>\n  | Action<ActionTypes.MOVE_FORWARD>\n  | Action<ActionTypes.MOVE_BACKWARD>\n  | Action<ActionTypes.TURN_LEFT>\n  | Action<ActionTypes.TURN_RIGHT>\n  | Action<ActionTypes.MOVE, Direction>\n);\n\nfunction startLevel(map: LevelMap): GameAction {\n  return {\n    type: ActionTypes.START_LEVEL,\n    payload: {\n      map\n    }\n  };\n}\n\nfunction finishLevel(): GameAction {\n  return { type: ActionTypes.FINISH_LEVEL };\n}\n\nfunction moveForward(): GameAction {\n  return { type: ActionTypes.MOVE_FORWARD };\n}\n\nfunction moveBackward(): GameAction {\n  return { type: ActionTypes.MOVE_BACKWARD };\n}\n\nfunction turnRight(): GameAction {\n  return { type: ActionTypes.TURN_RIGHT };\n}\n\nfunction turnLeft(): GameAction {\n  return { type: ActionTypes.TURN_LEFT };\n}\n\nfunction move(direction: Direction): GameAction {\n  return {\n    type: ActionTypes.MOVE,\n    payload: direction\n  };\n}\n\n\nexport {\n  startLevel,\n  finishLevel,\n  moveForward,\n  moveBackward,\n  turnRight,\n  turnLeft,\n  move\n};\n","import { Cmd, loop } from 'redux-loop';\nimport {\n  Direction,\n  move as getNeighbor,\n  oppositeDirection,\n  rotateLeft,\n  rotateRight\n} from '../../../mechanics/directions';\nimport getRelevantTiles from '../../../mechanics/getRelevantTiles';\nimport isLevelCleared from '../../../mechanics/isLevelCleared';\nimport isMoveValid from '../../../mechanics/isMoveValid';\nimport pushObjects from '../../../mechanics/pushObjects';\nimport { LevelMap } from '../../../mechanics/types';\nimport { assertNever, Reducer } from '../../../utils/types';\nimport { levelsActions } from '../levels';\nimport { finishLevel, GameAction, move } from './actions';\nimport { ActionTypes, State } from './types';\n\n\nconst INITIAL_STATE: State = {\n  finished: false\n};\n\ntype TriggeredAction = GameAction | ReturnType<typeof levelsActions.clearLevel>;\n\nconst gameReducer: Reducer<State, GameAction, TriggeredAction> = (state = INITIAL_STATE, action) => {\n  if (action.type === ActionTypes.START_LEVEL) {\n    const { map } = action.payload;\n\n    return {\n      finished: false,\n      map\n    };\n  } else if (state.map) {\n    switch (action.type) {\n      case ActionTypes.MOVE_FORWARD: {\n        const direction = state.map.robot.direction;\n\n        if (canMove(state.map, direction)) {\n          return loop(state, Cmd.action(move(direction)));\n        }\n        return state;\n      }\n      case ActionTypes.MOVE_BACKWARD: {\n        const direction = oppositeDirection(state.map.robot.direction);\n\n        if (canMove(state.map, direction)) {\n          return loop(state, Cmd.action(move(direction)));\n        }\n        return state;\n      }\n      case ActionTypes.TURN_RIGHT:\n        return {\n          ...state,\n          map: {\n            ...state.map,\n            robot: {\n              ...state.map.robot,\n              direction: rotateRight(state.map.robot.direction)\n            }\n          }\n        };\n      case ActionTypes.TURN_LEFT:\n        return {\n          ...state,\n          map: {\n            ...state.map,\n            robot: {\n              ...state.map.robot,\n              direction: rotateLeft(state.map.robot.direction)\n            }\n          }\n        };\n      case ActionTypes.MOVE:\n        const newState = {\n          ...state,\n          map: {\n            ...state.map,\n            tiles: pushObjects(state.map.tiles, state.map.robot.position, action.payload),\n            robot: {\n              ...state.map.robot,\n              position: getNeighbor(state.map.robot.position, action.payload),\n            }\n          }\n        };\n        if (isLevelCleared(newState.map)) {\n          return loop(newState, Cmd.action(finishLevel()));\n        }\n        return newState;\n      case ActionTypes.FINISH_LEVEL:\n        return loop(\n          { ...state, finished: true },\n          Cmd.action(levelsActions.clearLevel())\n        );\n      default:\n        assertNever(action);\n        return state;\n    }\n  } else {\n    return state;\n  }\n};\n\nfunction canMove(state: LevelMap, direction: Direction) {\n  const relevantTiles = getRelevantTiles(state.tiles, state.robot.position, direction);\n  return isMoveValid(...relevantTiles);\n}\n\n\nexport default gameReducer;\nexport { INITIAL_STATE };\n","import { Direction } from '../../../mechanics/directions';\nimport { LevelMap, MovableObject } from '../../../mechanics/types';\nimport { State } from './types';\n\n\ninterface TileStaticInfo {\n  x: number;\n  y: number;\n  height: number;\n  hasTarget: boolean;\n}\n\ninterface MovableObjectsInfo extends MovableObject {\n  position: [number, number, number];\n}\n\n\nfunction getRobotPosition(state: State): [number, number, number] {\n  assertMapDefined(state);\n\n  const [x, y] = state.map.robot.position;\n  const z = state.map.tiles[x][y].height + state.map.tiles[x][y].objects.length + 1;\n\n  return [x, y, z];\n}\n\nfunction getRobotDirection(state: State): Direction {\n  assertMapDefined(state);\n  return state.map.robot.direction;\n}\n\nfunction getRobotKey(state: State): string {\n  assertMapDefined(state);\n  return state.map.robot.key!;\n}\n\nfunction getMapDimensions(state: State): [number, number] {\n  assertMapDefined(state);\n  return [state.map.width, state.map.height];\n}\n\n/**\n * Lists the static info about all map tiles.\n */\nfunction getTilesInfo(state: State): TileStaticInfo[] {\n  assertMapDefined(state);\n\n  const { map: { tiles }} = state;\n  const targets = new Set<string>(state.map.targets.map(point => point.join('-')));\n  const tilesInfo = [];\n\n  for (let x = 0; x < tiles.length; x++) {\n    for (let y = 0; y < tiles[x].length; y++) {\n      const height = tiles[x][y].height;\n      const hasTarget = targets.has(x + '-' + y);\n\n      tilesInfo.push({ x, y, height, hasTarget });\n    }\n  }\n  return tilesInfo;\n}\n\n/**\n * Lists all map objects that can be moved (pushed).\n */\nfunction getMovableObjectsInfo(state: State): MovableObjectsInfo[] {\n  assertMapDefined(state);\n\n  const { map: { tiles }} = state;\n  const allObjects = [];\n\n  for (let x = 0; x < tiles.length; x++) {\n    for (let y = 0; y < tiles[x].length; y++) {\n      const tileObjects = tiles[x][y].objects.map((obj, index) => {\n        return {\n          ...obj,\n          position: [x, y, tiles[x][y].height + index + 1]\n        } as MovableObjectsInfo;\n      });\n\n      allObjects.push(...tileObjects);\n    }\n  }\n  return allObjects;\n}\n\nfunction isLevelCleared(state: State): boolean {\n  return state.finished;\n}\n\nfunction assertMapDefined(state: State): asserts state is State & { map: LevelMap } {\n  if (!state.map) {\n    throw Error('No map defined.');\n  }\n}\n\n\nexport {\n  getRobotPosition,\n  getRobotDirection,\n  getRobotKey,\n  getMapDimensions,\n  getTilesInfo,\n  getMovableObjectsInfo,\n  isLevelCleared\n};\n","import reducer from './reducer';\nimport * as gameActions from './actions';\nimport * as gameSelectors from './selectors';\n\n\nexport {\n  gameActions,\n  gameSelectors\n};\n\n\nexport default reducer;\n","import { DeepReadonly } from 'utility-types';\n\n\nexport enum ActionTypes {\n  TOGGLE_ON_SCREEN_CONTROLS = 'settings/TOGGLE_ON_SCREEN_CONTROLS'\n}\n\nexport type State = DeepReadonly<{\n  onScreenControls: boolean;\n}>;\n","import { assertNever, Reducer } from '../../../utils/types';\nimport { SettingsAction } from './actions';\nimport { ActionTypes, State } from './types';\n\n\nconst INITIAL_STATE: State = {\n  onScreenControls: true\n};\n\nconst settingsReducer: Reducer<State, SettingsAction> = (state = INITIAL_STATE, action) => {\n  switch (action.type) {\n    case ActionTypes.TOGGLE_ON_SCREEN_CONTROLS:\n      return {\n        onScreenControls: !state.onScreenControls\n      };\n    default:\n      assertNever(action.type);\n      return state;\n  }\n};\n\n\nexport default settingsReducer;\nexport { INITIAL_STATE };\n","import { Action } from '../../../utils/types';\nimport { ActionTypes } from './types';\n\n\nexport type SettingsAction = (\n  Action<ActionTypes.TOGGLE_ON_SCREEN_CONTROLS>\n);\n\nfunction toggleOnScreenControls(): SettingsAction {\n  return { type: ActionTypes.TOGGLE_ON_SCREEN_CONTROLS };\n}\n\n\nexport {\n  toggleOnScreenControls\n};\n","import { State } from './types';\n\n\nfunction displayOnScreenControls(state: State): boolean {\n  return state.onScreenControls;\n}\n\n\nexport {\n  displayOnScreenControls\n};\n","import reducer from './reducer';\nimport * as settingsActions from './actions';\nimport * as settingsSelectors from './selectors';\n\n\nexport {\n  settingsActions,\n  settingsSelectors\n};\n\n\nexport default reducer;\n","import { connectRouter } from 'connected-react-router';\nimport { History } from 'history';\nimport game from './game';\nimport levels from './levels';\nimport settings from './settings';\nimport { combineReducers } from 'redux-loop';\nimport { State } from '../types';\n\n\nfunction createRootReducer(history: History) {\n  return combineReducers<State, any>({\n    game,\n    levels,\n    settings,\n    router: connectRouter(history)\n  });\n}\n\n\nexport default createRootReducer;\n","import { State } from './types';\nimport { Store } from 'redux';\n\n\n/**\n * Loads the specified state slices from local storage.\n */\nfunction loadPersistedState(slices: Array<keyof State>): Partial<State> {\n  const persistedState: Partial<State> = {};\n\n  slices.forEach(sliceName => {\n    try {\n      const serializedSliceState = localStorage.getItem(sliceName);\n\n      if (serializedSliceState) {\n        persistedState[sliceName] = JSON.parse(serializedSliceState);\n      }\n    } catch (err) {\n      console.warn(`Failed to load the state of slice \"${sliceName}\"`, err);\n    }\n  });\n  return persistedState;\n}\n\n/**\n * Persists the specified state slices to local storage.\n */\nfunction setupStatePersistence(store: Store<State>, slices: Array<keyof State>) {\n  let previousState = new Map(Object.entries(store.getState()));\n\n  store.subscribe(() => {\n    const newState = new Map(Object.entries(store.getState()));\n    const changedSlices = slices.filter(sliceName => newState.get(sliceName) !== previousState.get(sliceName));\n\n    changedSlices.forEach(sliceName => {\n      saveSliceState(sliceName, newState.get(sliceName)!);\n    });\n    if (changedSlices.length > 0) {\n      previousState = newState;\n    }\n  });\n}\n\n/**\n * Save the specified slice to local storage.\n */\nfunction saveSliceState<K extends keyof State>(sliceName: K, sliceState: State[K]) {\n  try {\n    const serializedSlice = JSON.stringify(sliceState);\n\n    localStorage.setItem(sliceName, serializedSlice);\n  } catch (err) {\n    console.warn(`Failed to persist the state of slice \"${sliceName}\"`, err);\n  }\n}\n\n\nexport {\n  loadPersistedState,\n  setupStatePersistence\n};\n","import { routerMiddleware } from 'connected-react-router';\nimport { createBrowserHistory } from 'history';\nimport { applyMiddleware, compose, createStore } from 'redux';\nimport { install, StoreCreator } from 'redux-loop';\nimport createRootReducer from './ducks';\nimport { loadPersistedState, setupStatePersistence } from './localStorage';\nimport { State } from './types';\n\n\nconst PERSISTENT_SLICES: Array<keyof State> = ['levels', 'settings'];\n\nconst composeEnhancers = (window as any).__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ ?? compose;\n\nfunction configureStore() {\n  const persistedState = loadPersistedState(PERSISTENT_SLICES);\n  const history = createBrowserHistory({ basename: 'sokobot-3d' });\n  const enhancer = composeEnhancers(\n    applyMiddleware(routerMiddleware(history)),\n    install()\n  );\n  const enhancedCreateStore = createStore as StoreCreator;\n  const store = enhancedCreateStore(createRootReducer(history), persistedState as State, enhancer);\n\n  setupStatePersistence(store, PERSISTENT_SLICES);\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (module.hot) {\n      module.hot.accept('./ducks', () => {\n        store.replaceReducer(createRootReducer(history) as any);\n      });\n    }\n  }\n  return {\n    store,\n    history\n  };\n}\n\n\nexport {\n  configureStore\n};\n","import { goBack } from 'connected-react-router';\nimport { Button } from 'grommet';\nimport { Previous } from 'grommet-icons';\nimport React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { Dispatch } from 'redux';\n\n\ninterface BackButtonProps extends ConnectedProps<typeof connector> {\n}\n\nfunction BackButton({ goBack }: BackButtonProps) {\n  return <Button icon={<Previous/>} label=\"Back\" onClick={() => goBack()}/>;\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch) {\n  return {\n    goBack: () => dispatch(goBack())\n  };\n}\n\nconst connector = connect(null, mapDispatchToProps);\n\n\nexport default connector(BackButton);\nexport { BackButton };\n","import { Box } from 'grommet';\nimport React from 'react';\nimport styled from 'styled-components';\n\ninterface ScreenProps {\n  title: string;\n  children: React.ReactNode;\n}\n\nconst H1 = styled.h1`\n  text-align: center;\n`;\n\nfunction Screen({ title, children }: ScreenProps) {\n  return (\n    <Box width=\"medium\">\n      <header>\n        <H1>{title}</H1>\n      </header>\n      <Box width=\"medium\" gap=\"small\" align=\"stretch\">\n        {children}\n      </Box>\n    </Box>\n  );\n}\n\nexport default Screen;\n","import { CheckBox } from 'grommet';\nimport React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { Dispatch } from 'redux';\nimport { settingsActions, settingsSelectors } from '../../state/ducks/settings';\nimport { State } from '../../state/types';\nimport BackButton from '../BackButton';\nimport Screen from '../Screen';\n\n\ninterface SettingsProps extends ConnectedProps<typeof connector> {\n}\n\nfunction Settings({ displayOnScreenControls, toggleOnScreenControls }: SettingsProps) {\n  return (\n    <Screen title=\"Settings\">\n      <CheckBox label=\"Display on-screen controls (required on devices without a keyboard)\"\n                checked={displayOnScreenControls}\n                onChange={toggleOnScreenControls}\n      />\n      <BackButton/>\n    </Screen>\n  );\n}\n\nfunction mapStateToProps(state: State) {\n  return {\n    displayOnScreenControls: settingsSelectors.displayOnScreenControls(state.settings)\n  };\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch) {\n  return {\n    toggleOnScreenControls: () => dispatch(settingsActions.toggleOnScreenControls())\n  };\n}\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\n\nexport default connector(Settings);\nexport { Settings };\n","import { push } from 'connected-react-router';\nimport { Button } from 'grommet';\nimport { Play, SettingsOption } from 'grommet-icons';\nimport React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { Dispatch } from 'redux';\nimport Screen from '../Screen';\n\n\ninterface MenuProps extends ConnectedProps<typeof connector> {\n}\n\nfunction Menu({ startGame, openSettings }: MenuProps) {\n  return (\n    <Screen title=\"Sokobot\">\n      <Button icon={<Play/>} label=\"Start Game\" onClick={startGame}/>\n      <Button icon={<SettingsOption/>} label=\"Settings\" onClick={openSettings}/>\n    </Screen>\n  );\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch) {\n  return {\n    startGame: () => dispatch(push('/select-level')),\n    openSettings: () => dispatch(push('/settings'))\n  };\n}\n\nconst connector = connect(null, mapDispatchToProps);\n\n\nexport default connector(Menu);\nexport { Menu };\n","import { push } from 'connected-react-router';\nimport { Button } from 'grommet';\nimport { Lock, Unlock } from 'grommet-icons';\nimport React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { Dispatch } from 'redux';\nimport { getLevelNames } from '../../levels';\nimport { State } from '../../state/types';\nimport { levelsSelectors } from '../../state/ducks/levels';\nimport Screen from '../Screen';\n\n\ninterface LevelSelectionProps extends ConnectedProps<typeof connector> {\n}\n\nfunction LevelSelection({ isUnlocked, selectLevel }: LevelSelectionProps) {\n  return (\n    <Screen title=\"Select Level\">\n      {getLevelNames().map((levelName, level) => (\n        isUnlocked(level)\n          ? <Button key={level} label={levelName} icon={<Unlock/>} onClick={() => selectLevel(level)}/>\n          : <Button key={level} label={levelName} icon={<Lock/>} disabled={true}/>\n      ))}\n    </Screen>\n  );\n}\n\nfunction mapStateToProps(state: State) {\n  return {\n    isUnlocked: (level: number) => levelsSelectors.isUnlocked(state.levels, level)\n  };\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch) {\n  return {\n    selectLevel: (level: number) => dispatch(push(`/level/${level}`))\n  };\n}\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\n\nexport default connector(LevelSelection);\nexport { LevelSelection };\n","import React, { useEffect } from 'react';\n\n\n/**\n * Same as {@link useEffect}, but for side effects that should only happen once, when the component is first rendered.\n */\nfunction useEffectOnce(effect: React.EffectCallback) {\n  useEffect(effect, []);\n}\n\n\nexport default useEffectOnce;\n","import { useEffect, useRef } from 'react';\nimport { minimizeRotation } from '../../mechanics/directions';\n\n\n/**\n * Keeps track of an angle and minimizes the rotation needed to bring it to the current direction.\n *\n * @param currentDirection - an angle (in radians) indicating the current direction, within a circumference\n * @return the closest angle to the previous, which points in the same direction as {@param currentDirection}\n */\nfunction useMinimalRotation(currentDirection: number): number {\n  const ref = useRef<number>();\n  const previousAngle = ref.current;\n  const currentAngle = previousAngle === undefined ? currentDirection : minimizeRotation(previousAngle, currentDirection);\n  useEffect(() => {\n    ref.current = currentAngle;\n  });\n  return currentAngle;\n}\n\n\nexport default useMinimalRotation;\n","import { useEffect, useRef } from 'react';\nimport { Maybe } from '../types';\n\n\n/**\n * Keeps track of the value of a prop, last time the component was rendered.\n *\n * @return the previous value\n */\nfunction usePrevious<T>(currentValue: T): Maybe<T> {\n  const ref = useRef<T>();\n  useEffect(() => {\n    ref.current = currentValue;\n  });\n  return ref.current;\n}\n\n\nexport default usePrevious;\n","import { SpringUpdateFn } from '@react-spring/core';\nimport { useSpring } from '@react-spring/three';\nimport { usePrevious } from './index';\n\n\ninterface SimpleMovementAnimationProps {\n  position: [number, number, number];\n  [prop: string]: any;\n}\n\n/**\n * Uses very simple animations to smoothly transition between states.\n */\nfunction useSimpleMovementAnimation<T extends SimpleMovementAnimationProps>(currentProps: T) {\n  const { position } = currentProps;\n  const previousProps = usePrevious(currentProps);\n\n  return useSpring<any>({\n    from: previousProps ?? currentProps,\n    to: async (next: SpringUpdateFn<T>) => {\n      // Handles falls\n      if (previousProps && position[2] < previousProps.position[2]) {\n\n        // moves horizontally\n        await next({\n          ...currentProps,\n          position: [position[0], position[1], previousProps.position[2]]\n        });\n\n        // falls\n        await next({\n          ...currentProps,\n          config: {\n            duration: 100\n          }\n        });\n        return;\n      }\n\n      // Handles simple movements (rotation and horizontal move)\n      await next(currentProps);\n    }\n  });\n}\n\n\nexport default useSimpleMovementAnimation;\n","import React, { useRef } from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { extend, useThree } from 'react-three-fiber';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { gameSelectors } from '../../state/ducks/game';\nimport { State } from '../../state/types';\nimport { useEffectOnce } from '../../utils/hooks';\n\n// False positive, when only the type is needed\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { ReactThreeFiber } from 'react-three-fiber';\n\n\nextend({ OrbitControls });\n\ndeclare global {\n  namespace JSX {\n    interface IntrinsicElements {\n      'orbitControls': ReactThreeFiber.Object3DNode<OrbitControls, typeof OrbitControls>;\n    }\n  }\n}\n\ninterface CameraControlsProps extends ConnectedProps<typeof connector> {\n}\n\nfunction CameraControls({ initialPosition }: CameraControlsProps) {\n  const { camera, gl } = useThree();\n  const controls = useRef<OrbitControls>();\n\n  useEffectOnce(() => {\n    if (initialPosition) {\n      camera.position.set(...initialPosition);\n      if (controls.current) {\n        controls.current.update();\n      }\n    }\n  });\n\n  return <orbitControls args={[camera, gl.domElement]} maxPolarAngle={Math.PI / 2} enablePan={false} ref={controls}/>;\n}\n\nfunction mapStateToProps(state: State) {\n  return {\n    // TODO: find a proper way to determine a good initial camera position\n    initialPosition: (() => {\n      try {\n        const mapDimensions = gameSelectors.getMapDimensions(state.game);\n        const n = Math.max(3, Math.max(...mapDimensions) * 0.7);\n\n        return [n, n, n] as const;\n      } catch {\n      }\n      return undefined;\n    })()\n  };\n}\n\nconst connector = connect(mapStateToProps);\n\n\nexport default connector(CameraControls);\nexport { CameraControls };\n","import React from 'react';\nimport { a } from 'react-spring/three';\nimport { useSimpleMovementAnimation } from '../../utils/hooks';\n\n\ninterface CardboardBoxProps {\n  position: [number, number, number];\n}\n\nfunction CardboardBox({ position }: CardboardBoxProps) {\n  const props = useSimpleMovementAnimation({ position });\n\n  return (\n    <a.mesh {...props} castShadow={true} receiveShadow={true}>\n      <boxBufferGeometry attach=\"geometry\" args={[1, 1, 1]}/>\n      <meshLambertMaterial attach=\"material\" color={0xaa8844}/>\n    </a.mesh>\n  );\n}\n\n\nexport default CardboardBox;\n","import React from 'react';\n\n\ninterface GroundElevationProps {\n  x: number;\n  y: number;\n  height: number;\n}\n\nfunction GroundElevation({ x, y, height }: GroundElevationProps) {\n  return (\n    <mesh position={[x, y, (1 + height) / 2]} castShadow={true} receiveShadow={true}>\n      <boxBufferGeometry attach=\"geometry\" args={[1, 1, height]}/>\n      <meshPhongMaterial attach=\"material\" color={0x555555}/>\n    </mesh>\n  );\n}\n\n\nexport default GroundElevation;\n","import React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { a } from 'react-spring/three';\nimport { gameSelectors } from '../../state/ducks/game';\nimport { State } from '../../state/types';\nimport { directionToAngle } from '../../mechanics/directions';\nimport { useMinimalRotation, useSimpleMovementAnimation } from '../../utils/hooks';\n\n\ninterface RobotProps extends ConnectedProps<typeof connector> {\n}\n\nfunction Robot({ position, direction }: RobotProps) {\n  const zRotation = useMinimalRotation(direction);\n  const props = useSimpleMovementAnimation({\n    position,\n    rotation: [0, 0, zRotation]\n  });\n\n  return (\n    <a.mesh {...props} castShadow={true} receiveShadow={true}>\n      <coneBufferGeometry attach=\"geometry\" args={[0.5, 1, 10]}/>\n      <meshLambertMaterial attach=\"material\" color={0x6A0BFF}/>\n    </a.mesh>\n  );\n}\n\nfunction mapStateToProps(state: State) {\n  return {\n    position: gameSelectors.getRobotPosition(state.game),\n    direction: directionToAngle(gameSelectors.getRobotDirection(state.game))\n  };\n}\n\nconst connector = connect(mapStateToProps);\n\n\nexport default connector(Robot);\nexport { Robot };\n","import React from 'react';\n\n\ninterface TargetTileProps {\n  x: number;\n  y: number;\n  height: number;\n}\n\nfunction TargetTile({ x, y, height }: TargetTileProps) {\n  return (\n    <mesh position={[x, y, height + .51]} receiveShadow={true}>\n      <planeBufferGeometry attach=\"geometry\" args={[1, 1]}/>\n      <meshLambertMaterial attach=\"material\" color={0x00FF00}/>\n    </mesh>\n  );\n}\n\n\nexport default TargetTile;\n","import React, { Fragment } from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { gameSelectors } from '../../state/ducks/game';\nimport { State } from '../../state/types';\nimport CardboardBox from './CardboardBox';\nimport GroundElevation from './GroundElevation';\nimport Robot from './Robot';\nimport TargetTile from './TargetTile';\n\n\ninterface MapProps extends ConnectedProps<typeof connector> {\n}\n\nfunction Map({ mapDimensions, tilesInfo, movableObjectsInfo, robotKey }: MapProps) {\n  const [xSize, ySize] = mapDimensions;\n\n  return (\n    <group position={[(1 - xSize) / 2, (1 - ySize) / 2, -0.5]}>\n      <Robot key={robotKey}/>\n      {tilesInfo.map(({ x, y, height, hasTarget }) => (\n        <Fragment key={`${x}-${y}`}>\n          {height > 0 && <GroundElevation x={x} y={y} height={height}/>}\n          {hasTarget && <TargetTile x={x} y={y} height={height}/>}\n        </Fragment>\n      ))}\n      {movableObjectsInfo.map(({ key, position }) => (\n        <CardboardBox key={key} position={position}/>\n      ))}\n    </group>\n  );\n}\n\nfunction mapStateToProps(state: State) {\n  return {\n    mapDimensions: gameSelectors.getMapDimensions(state.game),\n    tilesInfo: gameSelectors.getTilesInfo(state.game),\n    movableObjectsInfo: gameSelectors.getMovableObjectsInfo(state.game),\n    robotKey: gameSelectors.getRobotKey(state.game)\n  };\n}\n\nconst connector = connect(mapStateToProps);\n\n\nexport default connector(Map);\nexport { Map };\n","import React from 'react';\nimport { ReactReduxContext, Provider } from 'react-redux';\nimport { Canvas } from 'react-three-fiber';\nimport { AxesHelper } from 'react-three-fiber/components';\nimport { Color } from 'three';\nimport CameraControls from './CameraControls';\nimport Map from './Map';\n\n\nfunction MyCanvas() {\n  return (\n    <ReactReduxContext.Consumer>\n      {({ store }) => (\n        <Canvas shadowMap style={{ backgroundColor: 'black', height: '100%', position: 'absolute', top: 0, left: 0 }}>\n          <Provider store={store}>\n            <CameraControls/>\n            <group rotation={[-Math.PI / 2, 0, 0]}>\n              {process.env.NODE_ENV !== 'production' && <AxesHelper scale={[10, 10, 10]}/>}\n              <ambientLight intensity={0.3}/>\n              <spotLight\n                color={new Color('#fffda7')}\n                castShadow\n                intensity={0.7}\n                penumbra={1}\n                decay={1}\n                angle={Math.PI / 8}\n                position={[10, 10, 10]}\n                shadow-mapSize-width={2048}\n                shadow-mapSize-height={2048}\n              />\n              <Map/>\n            </group>\n          </Provider>\n        </Canvas>\n      )}\n    </ReactReduxContext.Consumer>\n  );\n}\n\n\nexport default MyCanvas;\n","import { Box, Button } from 'grommet';\nimport { LinkDown, LinkUp, RotateLeft, RotateRight } from 'grommet-icons';\nimport React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { Dispatch } from 'redux';\nimport styled from 'styled-components';\nimport { gameActions } from '../../../state/ducks/game';\nimport { settingsSelectors } from '../../../state/ducks/settings';\nimport { State } from '../../../state/types';\nimport { useEffectOnce } from '../../../utils/hooks';\n\n\ninterface ControlsProps extends ConnectedProps<typeof connector> {\n}\n\nfunction GameControls({ displayOnScreenControls, moveForward, moveBackward, turnLeft, turnRight }: ControlsProps) {\n  const onKeyPress = createKeyPressHandler({\n    W: moveForward,\n    A: turnLeft,\n    S: moveBackward,\n    D: turnRight\n  });\n\n  useEffectOnce(() => {\n    window.addEventListener('keypress', onKeyPress);\n    return () => {\n      window.removeEventListener('keypress', onKeyPress);\n    };\n  });\n\n  if (displayOnScreenControls) {\n    return (\n      <Wrapper>\n        <Box align=\"center\">\n          <IconButton icon={<LinkUp/>} title=\"Move forward (W)\" onClick={moveForward}/>\n        </Box>\n        <Box direction=\"row\">\n          <IconButton icon={<RotateLeft/>} title=\"Turn left (A)\" onClick={turnLeft}/>\n          <IconButton icon={<LinkDown/>} title=\"Move backward (S)\" onClick={moveBackward}/>\n          <IconButton icon={<RotateRight/>} title=\"Turn right (D)\" onClick={turnRight}/>\n        </Box>\n      </Wrapper>\n    );\n  }\n  return null;\n}\n\nfunction createKeyPressHandler(keyMapping: { [key: string]: () => void }) {\n  return (event: KeyboardEvent) => {\n    const key = event.key.toUpperCase();\n\n    if (key in keyMapping) {\n      keyMapping[key].call(null);\n    }\n  };\n}\n\nconst Wrapper = styled.div`\n  position: fixed;\n  bottom: .5rem;\n  right: .5rem;\n  z-index: 1000;\n`;\n\ninterface IconButtonProps {\n  icon: JSX.Element;\n  title: string;\n  onClick: () => void;\n}\n\nfunction IconButton(props: IconButtonProps) {\n  return <Button {...props} plain={false} margin=\"xxsmall\"/>;\n}\n\nfunction mapStateToProps(state: State) {\n  return {\n    displayOnScreenControls: settingsSelectors.displayOnScreenControls(state.settings)\n  };\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch) {\n  return {\n    moveForward: () => dispatch(gameActions.moveForward()),\n    moveBackward: () => dispatch(gameActions.moveBackward()),\n    turnLeft: () => dispatch(gameActions.turnLeft()),\n    turnRight: () => dispatch(gameActions.turnRight())\n  };\n}\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\n\nexport default connector(GameControls);\nexport { GameControls };\n","import { push } from 'connected-react-router';\nimport { Box, Button } from 'grommet';\nimport React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { Dispatch } from 'redux';\nimport styled from 'styled-components';\nimport { levelsSelectors } from '../../../state/ducks/levels';\nimport { State } from '../../../state/types';\n\n\ninterface LevelClearedDialogProps extends ConnectedProps<typeof connector> {\n}\n\nfunction LevelClearedDialog({ nextLevel, goToLevel, goToLevelSelection }: LevelClearedDialogProps) {\n  const message = nextLevel === undefined ? 'Congratulations, you finished the game!' : 'Level Cleared';\n\n  return (\n    <DialogWrapper>\n      <Box width=\"medium\" gap=\"small\" align=\"stretch\" pad=\"small\">\n        <h1>{message}</h1>\n        {nextLevel !== undefined && <Button label=\"Go to next level\" onClick={() => goToLevel(nextLevel)}/>}\n        <Button label=\"Back to level selection\" onClick={goToLevelSelection}/>\n      </Box>\n    </DialogWrapper>\n  );\n}\n\nconst DialogWrapper = styled.div`\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 1000;\n  background-color: rgba(0, 0, 0, 0.3);\n  border-radius: 1em;\n  h1 {\n    text-align: center;\n    line-height: 1.2em;\n  }\n`;\n\nfunction mapStateToProps(state: State) {\n  return {\n    nextLevel: levelsSelectors.getNextLevel(state.levels)\n  };\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch) {\n  return {\n    goToLevel: (level: number) => dispatch(push(`/level/${level}`)),\n    goToLevelSelection: () => dispatch(push('/select-level'))\n  };\n}\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\n\nexport default connector(LevelClearedDialog);\nexport { LevelClearedDialog };\n","import { Button } from 'grommet';\nimport { Refresh } from 'grommet-icons';\nimport React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { Dispatch } from 'redux';\nimport styled from 'styled-components';\nimport { levelsActions, levelsSelectors } from '../../../state/ducks/levels';\nimport { State } from '../../../state/types';\n\n\ninterface RestartButtonProps extends ConnectedProps<typeof connector> {\n}\n\nfunction RestartButton({ level, restart }: RestartButtonProps) {\n  return (\n    <Wrapper>\n      <Button label=\"Restart\" icon={<Refresh/>} onClick={() => restart(level)}/>\n    </Wrapper>\n  );\n}\n\nconst Wrapper = styled.div`\n  position: fixed;\n  top: .5rem;\n  left: .5rem;\n  z-index: 1000;\n`;\n\nfunction mapStateToProps(state: State) {\n  return {\n    level: levelsSelectors.getSelectedLevel(state.levels)!\n  };\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch) {\n  return {\n    restart: (level: number) => dispatch(levelsActions.selectLevel(level))\n  };\n}\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\n\nexport default connector(RestartButton);\nexport { RestartButton };\n","import React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { Redirect, RouteComponentProps } from 'react-router';\nimport { getLevelNames } from '../../../levels';\nimport { gameSelectors } from '../../../state/ducks/game';\nimport { levelsSelectors } from '../../../state/ducks/levels';\nimport { State } from '../../../state/types';\nimport Screen from '../../Screen';\nimport MyCanvas from '../../webgl/MyCanvas';\nimport GameControls from './GameControls';\nimport LevelClearedDialog from './LevelClearedDialog';\nimport RestartButton from './RestartButton';\n\n\ninterface MatchParams {\n  level: string;\n}\n\ninterface LevelProps extends ConnectedProps<typeof connector> {\n}\n\nfunction Level({ isLevelCleared, isUnlocked, levelName }: LevelProps) {\n  if (levelName === undefined || !isUnlocked) {\n    return <Redirect to=\"/select-level\"/>;\n  }\n  return (\n    <Screen title={levelName}>\n      <MyCanvas/>\n      {isLevelCleared ? (\n        <LevelClearedDialog/>\n      ) : (\n        <>\n          <GameControls/>\n          <RestartButton/>\n        </>\n      )}\n    </Screen>\n  );\n}\n\ninterface MatchParams {\n  level: string;\n}\n\nfunction mapStateToProps(state: State, { match }: RouteComponentProps<MatchParams>) {\n  const level = parseInt(match.params.level);\n\n  return {\n    isLevelCleared: gameSelectors.isLevelCleared(state.game),\n    isUnlocked: levelsSelectors.isUnlocked(state.levels, level),\n    levelName: getLevelNames()[level]\n  };\n}\n\nconst connector = connect(mapStateToProps);\n\n\nexport default connector(Level);\nexport { Level };\n","import Level from './Level';\n\nexport default Level;\n","import { ThemeType } from 'grommet';\nimport { DeepPartial } from 'utility-types';\n\n\nconst theme: DeepPartial<ThemeType> = {\n  global: {\n    colors: {\n      icon: {\n        dark: 'text'\n      },\n      brand: '#7D4CDB',\n      control: 'brand',\n      text: '#aaa',\n      background: '#000'\n    },\n    font: {\n      family: 'Arial'\n    }\n  }\n};\n\n\nexport default theme;\n","import React from 'react';\nimport { Grommet, Main, ThemeType } from 'grommet';\nimport { configureStore } from '../state/store';\nimport { Provider } from 'react-redux';\nimport { ConnectedRouter } from 'connected-react-router';\nimport { Redirect, Route, Switch } from 'react-router';\nimport Settings from './screens/Settings';\nimport Menu from './screens/Menu';\nimport LevelSelection from './screens/LevelSelection';\nimport Level from './screens/Level';\nimport theme from '../theme';\n\n\nconst { store, history } = configureStore();\n\nfunction App() {\n  return (\n    <Provider store={store}>\n      <ConnectedRouter history={history}>\n        <Grommet full theme={theme as ThemeType}>\n          <Main align=\"center\">\n            <Switch>\n              <Route exact path=\"/\" component={Menu}/>\n              <Route exact path=\"/settings\" component={Settings}/>\n              <Route exact path=\"/select-level\" component={LevelSelection}/>\n              <Route exact path=\"/level/:level\" component={Level}/>\n              <Route render={() => <Redirect to=\"/\"/>}/>\n            </Switch>\n          </Main>\n        </Grommet>\n      </ConnectedRouter>\n    </Provider>\n  );\n}\n\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// CRA docs about PWA: https://create-react-app.dev/docs/making-a-progressive-web-app/\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './components/App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\nserviceWorker.register();\n"],"sourceRoot":""}